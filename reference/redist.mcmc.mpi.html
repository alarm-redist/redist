<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>MCMC Redistricting Simulator using MPI — redist.mcmc.mpi • redist</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MCMC Redistricting Simulator using MPI — redist.mcmc.mpi"><meta name="description" content="redist.mcmc.mpi is used to simulate Congressional redistricting
plans using Markov Chain Monte Carlo methods."><meta property="og:description" content="redist.mcmc.mpi is used to simulate Congressional redistricting
plans using Markov Chain Monte Carlo methods."><meta property="og:image" content="/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">redist</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/redist.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/common_args.html">Common Arguments to `redist` Functions</a></li>
    <li><a class="dropdown-item" href="../articles/flip.html">Redistricting with Flip MCMC</a></li>
    <li><a class="dropdown-item" href="../articles/map-preproc.html">Map Pre-processing for Special Constraints</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://alarm-redist.github.io/posts/2021-04-02-redist-300/">redist 3.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/alarm-redist/redist/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>MCMC Redistricting Simulator using MPI</h1>
      <small class="dont-index">Source: <a href="https://github.com/alarm-redist/redist/blob/main/R/redistMPI.R" class="external-link"><code>R/redistMPI.R</code></a></small>
      <div class="d-none name"><code>redist.mcmc.mpi.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>redist.mcmc.mpi</code> is used to simulate Congressional redistricting
plans using Markov Chain Monte Carlo methods.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">redist.mcmc.mpi</span><span class="op">(</span></span>
<span>  <span class="va">adj</span>,</span>
<span>  <span class="va">total_pop</span>,</span>
<span>  <span class="va">nsims</span>,</span>
<span>  ndists <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  init_plan <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  loopscompleted <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nloop <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  nthin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  eprob <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pop_tol <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  group_pop <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  areasvec <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  counties <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  borderlength_mat <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  ssdmat <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  compactness_metric <span class="op">=</span> <span class="st">"fryer-holden"</span>,</span>
<span>  rngseed <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  constraint <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  constraintweights <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  betaseq <span class="op">=</span> <span class="st">"powerlaw"</span>,</span>
<span>  betaseqlength <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  adjswaps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  freq <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  savename <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  maxiterrsg <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cities <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-adj">adj<a class="anchor" aria-label="anchor" href="#arg-adj"></a></dt>
<dd><p>An adjacency matrix, list, or object of class
"SpatialPolygonsDataFrame."</p></dd>


<dt id="arg-total-pop">total_pop<a class="anchor" aria-label="anchor" href="#arg-total-pop"></a></dt>
<dd><p>A vector containing the populations of each geographic
unit.</p></dd>


<dt id="arg-nsims">nsims<a class="anchor" aria-label="anchor" href="#arg-nsims"></a></dt>
<dd><p>The number of simulations run before a save point.</p></dd>


<dt id="arg-ndists">ndists<a class="anchor" aria-label="anchor" href="#arg-ndists"></a></dt>
<dd><p>The number of congressional districts. The default is
<code>NULL</code>.</p></dd>


<dt id="arg-init-plan">init_plan<a class="anchor" aria-label="anchor" href="#arg-init-plan"></a></dt>
<dd><p>A vector containing the congressional district labels
of each geographic unit. The default is <code>NULL</code>. If not provided, random
and contiguous congressional district assignments will be generated using
<code>redist.rsg</code>.</p></dd>


<dt id="arg-loopscompleted">loopscompleted<a class="anchor" aria-label="anchor" href="#arg-loopscompleted"></a></dt>
<dd><p>Number of save points reached by the
algorithm. The default is <code>0</code>.</p></dd>


<dt id="arg-nloop">nloop<a class="anchor" aria-label="anchor" href="#arg-nloop"></a></dt>
<dd><p>The total number of save points for the algorithm. The
default is <code>1</code>. Note that the total number of simulations run
will be <code>nsims</code> * <code>nloop</code>.</p></dd>


<dt id="arg-nthin">nthin<a class="anchor" aria-label="anchor" href="#arg-nthin"></a></dt>
<dd><p>The amount by which to thin the Markov Chain. The default
is <code>1</code>.</p></dd>


<dt id="arg-eprob">eprob<a class="anchor" aria-label="anchor" href="#arg-eprob"></a></dt>
<dd><p>The probability of keeping an edge connected. The default
is <code>0.05</code>.</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>The parameter determining the number of swaps to attempt
each iteration of the algorithm. The number of swaps each iteration is
equal to Pois(<code>lambda</code>) + 1. The default is <code>0</code>.</p></dd>


<dt id="arg-pop-tol">pop_tol<a class="anchor" aria-label="anchor" href="#arg-pop-tol"></a></dt>
<dd><p>The strength of the hard population
constraint. <code>pop_tol</code> = 0.05 means that any proposed swap that
brings a district more than 5\<!-- % away from population parity will be -->
rejected. The default is <code>NULL</code>.</p></dd>


<dt id="arg-group-pop">group_pop<a class="anchor" aria-label="anchor" href="#arg-group-pop"></a></dt>
<dd><p>A vector of populations for some sub-group of
interest. The default is <code>NULL</code>.</p></dd>


<dt id="arg-areasvec">areasvec<a class="anchor" aria-label="anchor" href="#arg-areasvec"></a></dt>
<dd><p>A vector of precinct areas for discrete Polsby-Popper.
The default is <code>NULL</code>.</p></dd>


<dt id="arg-counties">counties<a class="anchor" aria-label="anchor" href="#arg-counties"></a></dt>
<dd><p>A vector of county membership assignments. The default is <code>NULL</code>.</p></dd>


<dt id="arg-borderlength-mat">borderlength_mat<a class="anchor" aria-label="anchor" href="#arg-borderlength-mat"></a></dt>
<dd><p>A matrix of border length distances, where
the first two columns are the indices of precincts sharing a border and
the third column is its distance. Default is <code>NULL</code>.</p></dd>


<dt id="arg-ssdmat">ssdmat<a class="anchor" aria-label="anchor" href="#arg-ssdmat"></a></dt>
<dd><p>A matrix of squared distances between geographic
units. The default is <code>NULL</code>.</p></dd>


<dt id="arg-compactness-metric">compactness_metric<a class="anchor" aria-label="anchor" href="#arg-compactness-metric"></a></dt>
<dd><p>The compactness metric to use when constraining on
compactness. Default is <code>fryer-holden</code>, the other implemented option
is <code>polsby-popper</code>.</p></dd>


<dt id="arg-rngseed">rngseed<a class="anchor" aria-label="anchor" href="#arg-rngseed"></a></dt>
<dd><p>Allows the user to set the seed for the
simulations. Default is <code>NULL</code>.</p></dd>


<dt id="arg-constraint">constraint<a class="anchor" aria-label="anchor" href="#arg-constraint"></a></dt>
<dd><p>Which constraint to apply. Accepts any combination of <code>compact</code>,
<code>vra</code>, <code>population</code>, <code>similarity</code>, or <code>none</code>
(no constraint applied). The default is NULL.</p></dd>


<dt id="arg-constraintweights">constraintweights<a class="anchor" aria-label="anchor" href="#arg-constraintweights"></a></dt>
<dd><p>The weights to apply to each constraint. Should be a vector
the same length as constraint. Default is NULL.</p></dd>


<dt id="arg-betaseq">betaseq<a class="anchor" aria-label="anchor" href="#arg-betaseq"></a></dt>
<dd><p>Sequence of beta values for tempering. The default is
<code>powerlaw</code> (see Fifield et. al (2015) for details).</p></dd>


<dt id="arg-betaseqlength">betaseqlength<a class="anchor" aria-label="anchor" href="#arg-betaseqlength"></a></dt>
<dd><p>Length of beta sequence desired for
tempering. The default is <code>10</code>.</p></dd>


<dt id="arg-adjswaps">adjswaps<a class="anchor" aria-label="anchor" href="#arg-adjswaps"></a></dt>
<dd><p>Flag to restrict swaps of beta so that only
values adjacent to current constraint are proposed. The default is
<code>TRUE</code>.</p></dd>


<dt id="arg-freq">freq<a class="anchor" aria-label="anchor" href="#arg-freq"></a></dt>
<dd><p>Frequency of between-chain swaps. Default to once every 100
iterations</p></dd>


<dt id="arg-savename">savename<a class="anchor" aria-label="anchor" href="#arg-savename"></a></dt>
<dd><p>Filename to save simulations. Default is <code>NULL</code>.</p></dd>


<dt id="arg-maxiterrsg">maxiterrsg<a class="anchor" aria-label="anchor" href="#arg-maxiterrsg"></a></dt>
<dd><p>Maximum number of iterations for random seed-and-grow
algorithm to generate starting values. Default is 5000.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Whether to print initialization statement. Default is
<code>TRUE</code>.</p></dd>


<dt id="arg-cities">cities<a class="anchor" aria-label="anchor" href="#arg-cities"></a></dt>
<dd><p>integer vector of cities for QPS constraint.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>redist.mcmc.mpi</code> returns an object of class "redist". The object
<code>redist</code> is a list that contains the following components (the
inclusion of some components is dependent on whether tempering
techniques are used):</p>
<dl><dt>partitions</dt>
<dd><p>Matrix of congressional district assignments generated by the
algorithm. Each row corresponds to a geographic unit, and each column
corresponds to a simulation.</p></dd>

<dt>distance_parity</dt>
<dd><p>Vector containing the maximum distance from parity for
a particular simulated redistricting plan.</p></dd>

<dt>mhdecisions</dt>
<dd><p>A vector specifying whether a proposed redistricting plan
was accepted (1) or rejected (0) in a given iteration.</p></dd>

<dt>mhprob</dt>
<dd><p>A vector containing the Metropolis-Hastings acceptance
probability for each iteration of the algorithm.</p></dd>

<dt>pparam</dt>
<dd><p>A vector containing the draw of the <code>p</code> parameter for each
simulation, which dictates the number of swaps attempted.</p></dd>

<dt>constraint_pop</dt>
<dd><p>A vector containing the value of the population
constraint for each accepted redistricting plan.</p></dd>

<dt>constraint_compact</dt>
<dd><p>A vector containing the value of the compactness
constraint for each accepted redistricting plan.</p></dd>

<dt>constraint_vra</dt>
<dd><p>A vector containing the value of the
vra constraint for each accepted redistricting plan.</p></dd>

<dt>constraint_similar</dt>
<dd><p>A vector containing the value of the similarity
constraint for each accepted redistricting plan.</p></dd>

<dt>beta_sequence</dt>
<dd><p>A vector containing the value of beta for each iteration
of the algorithm. Returned when tempering is being used.</p></dd>

<dt>mhdecisions_beta</dt>
<dd><p>A vector specifying whether a proposed beta value was
accepted (1) or rejected (0) in a given iteration of the algorithm. Returned
when tempering is being used.</p></dd>

<dt>mhprob_beta</dt>
<dd><p>A vector containing the Metropolis-Hastings acceptance
probability for each iteration of the algorithm. Returned when tempering
is being used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function allows users to simulate redistricting plans
using Markov Chain Monte Carlo methods. Several constraints
corresponding to substantive requirements in the redistricting process
are implemented, including population parity and geographic
compactness. In addition, the function includes multiple-swap and
parallel tempering functionality in MPI to improve the mixing of the Markov
Chain.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Fifield, Benjamin, Michael Higgins, Kosuke Imai and Alexander
Tarr. (2016) "A New Automated Redistricting Simulator Using Markov Chain Monte
Carlo." Working Paper. Available at
<a href="http://imai.princeton.edu/research/files/redist.pdf" class="external-link">http://imai.princeton.edu/research/files/redist.pdf</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Cannot run on machines without Rmpi</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fl25</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fl25_enum</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fl25_adj</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Code to run the simulations in Figure 4 in Fifield, Higgins, Imai and</span></span></span>
<span class="r-in"><span><span class="co">## Tarr (2015)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get an initial partition</span></span></span>
<span class="r-in"><span><span class="va">init_plan</span> <span class="op">&lt;-</span> <span class="va">fl25_enum</span><span class="op">$</span><span class="va">plans</span><span class="op">[</span>, <span class="fl">5118</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Run the algorithm</span></span></span>
<span class="r-in"><span><span class="fu">redist.mcmc.mpi</span><span class="op">(</span>adj <span class="op">=</span> <span class="va">fl25_adj</span>, total_pop <span class="op">=</span> <span class="va">fl25</span><span class="op">$</span><span class="va">pop</span>,</span></span>
<span class="r-in"><span>    init_plan <span class="op">=</span> <span class="va">init_plan</span>, nsims <span class="op">=</span> <span class="fl">10000</span>, savename <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher T. Kenny, Cory McCartan, Ben Fifield, Kosuke Imai.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

