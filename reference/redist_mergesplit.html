<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Merge-Split/Recombination MCMC Redistricting Sampler (Carter et al. 2019) — redist_mergesplit • redist</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Merge-Split/Recombination MCMC Redistricting Sampler (Carter et al. 2019) — redist_mergesplit"><meta name="description" content="redist_mergesplit uses a Markov Chain Monte Carlo algorithm (Carter et
al. 2019; based on DeFord et. al 2019) to generate congressional or legislative redistricting plans
according to contiguity, population, compactness, and administrative boundary
constraints. The MCMC proposal is the same as is used in the SMC sampler
(McCartan and Imai 2023); it is similar but not identical to those used in
the references.  1-level hierarchical Merge-split is supported through the
counties parameter; unlike in the SMC algorithm, this does not
guarantee a maximum number of county splits."><meta property="og:description" content="redist_mergesplit uses a Markov Chain Monte Carlo algorithm (Carter et
al. 2019; based on DeFord et. al 2019) to generate congressional or legislative redistricting plans
according to contiguity, population, compactness, and administrative boundary
constraints. The MCMC proposal is the same as is used in the SMC sampler
(McCartan and Imai 2023); it is similar but not identical to those used in
the references.  1-level hierarchical Merge-split is supported through the
counties parameter; unlike in the SMC algorithm, this does not
guarantee a maximum number of county splits."><meta property="og:image" content="/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">redist</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/redist.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/common_args.html">Common Arguments to `redist` Functions</a></li>
    <li><a class="dropdown-item" href="../articles/flip.html">Redistricting with Flip MCMC</a></li>
    <li><a class="dropdown-item" href="../articles/map-preproc.html">Map Pre-processing for Special Constraints</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://alarm-redist.github.io/posts/2021-04-02-redist-300/">redist 3.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/alarm-redist/redist/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Merge-Split/Recombination MCMC Redistricting Sampler (Carter et al. 2019)</h1>
      <small class="dont-index">Source: <a href="https://github.com/alarm-redist/redist/blob/main/R/redist_ms.R" class="external-link"><code>R/redist_ms.R</code></a></small>
      <div class="d-none name"><code>redist_mergesplit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>redist_mergesplit</code> uses a Markov Chain Monte Carlo algorithm (Carter et
al. 2019; based on DeFord et. al 2019) to generate congressional or legislative redistricting plans
according to contiguity, population, compactness, and administrative boundary
constraints. The MCMC proposal is the same as is used in the SMC sampler
(McCartan and Imai 2023); it is similar but not identical to those used in
the references.  1-level hierarchical Merge-split is supported through the
<code>counties</code> parameter; unlike in the SMC algorithm, this does not
guarantee a maximum number of county splits.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">redist_mergesplit</span><span class="op">(</span></span>
<span>  <span class="va">map</span>,</span>
<span>  <span class="va">nsims</span>,</span>
<span>  warmup <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">init_plan</span><span class="op">)</span><span class="op">)</span> <span class="fl">10</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">nsims</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  thin <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  init_plan <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  counties <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  compactness <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  constraint_fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  adapt_k_thresh <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  k <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  init_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  silly_adj_fix <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-map">map<a class="anchor" aria-label="anchor" href="#arg-map"></a></dt>
<dd><p>A <code><a href="redist_map.html">redist_map</a></code> object.</p></dd>


<dt id="arg-nsims">nsims<a class="anchor" aria-label="anchor" href="#arg-nsims"></a></dt>
<dd><p>The number of samples to draw, including warmup.</p></dd>


<dt id="arg-warmup">warmup<a class="anchor" aria-label="anchor" href="#arg-warmup"></a></dt>
<dd><p>The number of warmup samples to discard. Recommended to be at
least the first 20% of samples, and in any case no less than around 100
samples, unless initializing from a random plan.</p></dd>


<dt id="arg-thin">thin<a class="anchor" aria-label="anchor" href="#arg-thin"></a></dt>
<dd><p>Save every <code>thin</code>-th sample. Defaults to no thinning (1).</p></dd>


<dt id="arg-init-plan">init_plan<a class="anchor" aria-label="anchor" href="#arg-init-plan"></a></dt>
<dd><p>The initial state of the map. If not provided, will default to
the reference map of the <code>map</code> object, or if none exists, will sample
a random initial state using <code><a href="redist_smc.html">redist_smc</a></code>. You can also request
a random initial state by setting <code>init_plan="sample"</code>.</p></dd>


<dt id="arg-counties">counties<a class="anchor" aria-label="anchor" href="#arg-counties"></a></dt>
<dd><p>A vector containing county (or other administrative or
geographic unit) labels for each unit, which may be integers ranging from 1
to the number of counties, or a factor or character vector.  If provided,
the algorithm will generate maps tend to follow county lines. There is no
strength parameter associated with this constraint. To adjust the number of
county splits further, or to constrain a second type of administrative
split, consider using <code><a href="constraints.html">add_constr_splits()</a></code>, <code><a href="constraints.html">add_constr_multisplits()</a></code>,
and <code><a href="constraints.html">add_constr_total_splits()</a></code>.</p></dd>


<dt id="arg-compactness">compactness<a class="anchor" aria-label="anchor" href="#arg-compactness"></a></dt>
<dd><p>Controls the compactness of the generated districts, with
higher values preferring more compact districts. Must be nonnegative. See the
'Details' section for more information, and computational considerations.</p></dd>


<dt id="arg-constraints">constraints<a class="anchor" aria-label="anchor" href="#arg-constraints"></a></dt>
<dd><p>A list containing information on constraints to implement.
See the 'Details' section for more information.</p></dd>


<dt id="arg-constraint-fn">constraint_fn<a class="anchor" aria-label="anchor" href="#arg-constraint-fn"></a></dt>
<dd><p>A function which takes in a matrix where each column is
a redistricting plan and outputs a vector of log-weights, which will be
added the the final weights.</p></dd>


<dt id="arg-adapt-k-thresh">adapt_k_thresh<a class="anchor" aria-label="anchor" href="#arg-adapt-k-thresh"></a></dt>
<dd><p>The threshold value used in the heuristic to select a
value <code>k_i</code> for each splitting iteration. Set to 0.9999 or 1 if
the algorithm does not appear to be sampling from the target distribution.
Must be between 0 and 1.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>The number of edges to consider cutting after drawing a spanning
tree. Should be selected automatically in nearly all cases.</p></dd>


<dt id="arg-init-name">init_name<a class="anchor" aria-label="anchor" href="#arg-init-name"></a></dt>
<dd><p>a name for the initial plan, or <code>FALSE</code> to not include
the initial plan in the output.  Defaults to the column name of the
existing plan, or "<code>&lt;init&gt;</code>" if the initial plan is sampled.</p></dd>


<dt id="arg-silly-adj-fix">silly_adj_fix<a class="anchor" aria-label="anchor" href="#arg-silly-adj-fix"></a></dt>
<dd><p>Heuristic for fixing weird inputs.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Whether to print out intermediate information while sampling.
Recommended.</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>Whether to suppress all diagnostic information.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>redist_mergesplit</code> returns an object of class
<code><a href="redist_plans.html">redist_plans</a></code> containing the simulated plans.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function draws samples from a specific target measure, controlled by the
<code>map</code>, <code>compactness</code>, and <code>constraints</code> parameters.</p>
<p>Key to ensuring good performance is monitoring the acceptance rate, which
is reported at the sample level in the output.
Users should also check diagnostics of the sample by running
<code><a href="summary.redist_plans.html">summary.redist_plans()</a></code>.</p>
<p>Higher values of <code>compactness</code> sample more compact districts;
setting this parameter to 1 is computationally efficient and generates nicely
compact districts.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Carter, D., Herschlag, G., Hunter, Z., and Mattingly, J. (2019). A
merge-split proposal for reversible Monte Carlo Markov chain sampling of
redistricting plans. arXiv preprint arXiv:1911.01503.</p>
<p>McCartan, C., &amp; Imai, K. (2023). Sequential Monte Carlo for Sampling
Balanced and Compact Redistricting Plans. <em>Annals of Applied Statistics</em> 17(4).
Available at <a href="https://doi.org/10.1214/23-AOAS1763" class="external-link">doi:10.1214/23-AOAS1763</a>
.</p>
<p>DeFord, D., Duchin, M., and Solomon, J. (2019). Recombination: A family of
Markov chains for redistricting. arXiv preprint arXiv:1911.05725.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fl25</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fl_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="redist_map.html">redist_map</a></span><span class="op">(</span><span class="va">fl25</span>, ndists <span class="op">=</span> <span class="fl">3</span>, pop_tol <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Projecting to CRS 3857</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sampled_basic</span> <span class="op">&lt;-</span> <span class="fu">redist_mergesplit</span><span class="op">(</span><span class="va">fl_map</span>, <span class="fl">10000</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARKOV CHAIN MONTE CARLO</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sampling 10000 25-unit maps with 3 districts and population between 52513 and 64182.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Acceptance rate: 3.37%</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sampled_constr</span> <span class="op">&lt;-</span> <span class="fu">redist_mergesplit</span><span class="op">(</span><span class="va">fl_map</span>, <span class="fl">10000</span>, constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    incumbency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>strength <span class="op">=</span> <span class="fl">1000</span>, incumbents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MARKOV CHAIN MONTE CARLO</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sampling 10000 25-unit maps with 3 districts and population between 52513 and 64182.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">■                               </span>   0% | ETA: 2s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■ </span> 100% | ETA:  0s | MH Acceptance: 0.33</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Acceptance rate: 2.08%</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher T. Kenny, Cory McCartan, Ben Fifield, Kosuke Imai.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

