<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>'Flip' Markov Chain Monte Carlo Redistricting Simulation (Fifield et al. 2020) — redist_flip • redist</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="'Flip' Markov Chain Monte Carlo Redistricting Simulation (Fifield et al. 2020) — redist_flip"><meta name="description" content="This function allows users to simulate redistricting plans
using a Markov Chain Monte Carlo algorithm (Fifield, Higgins, Imai, and Tarr 2020). Several
constraints corresponding to substantive requirements in the redistricting
process are implemented, including population parity and geographic
compactness. In addition, the function includes multiple-swap and simulated
tempering functionality to improve the mixing of the Markov Chain."><meta property="og:description" content="This function allows users to simulate redistricting plans
using a Markov Chain Monte Carlo algorithm (Fifield, Higgins, Imai, and Tarr 2020). Several
constraints corresponding to substantive requirements in the redistricting
process are implemented, including population parity and geographic
compactness. In addition, the function includes multiple-swap and simulated
tempering functionality to improve the mixing of the Markov Chain."><meta property="og:image" content="/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">redist</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/redist.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/common_args.html">Common Arguments to `redist` Functions</a></li>
    <li><a class="dropdown-item" href="../articles/flip.html">Redistricting with Flip MCMC</a></li>
    <li><a class="dropdown-item" href="../articles/map-preproc.html">Map Pre-processing for Special Constraints</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://alarm-redist.github.io/posts/2021-04-02-redist-300/">redist 3.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/alarm-redist/redist/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>'Flip' Markov Chain Monte Carlo Redistricting Simulation (Fifield et al. 2020)</h1>
      <small class="dont-index">Source: <a href="https://github.com/alarm-redist/redist/blob/main/R/redist_flip.R" class="external-link"><code>R/redist_flip.R</code></a></small>
      <div class="d-none name"><code>redist_flip.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function allows users to simulate redistricting plans
using a Markov Chain Monte Carlo algorithm (Fifield, Higgins, Imai, and Tarr 2020). Several
constraints corresponding to substantive requirements in the redistricting
process are implemented, including population parity and geographic
compactness. In addition, the function includes multiple-swap and simulated
tempering functionality to improve the mixing of the Markov Chain.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">redist_flip</span><span class="op">(</span></span>
<span>  <span class="va">map</span>,</span>
<span>  <span class="va">nsims</span>,</span>
<span>  warmup <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  <span class="va">init_plan</span>,</span>
<span>  constraints <span class="op">=</span> <span class="fu"><a href="constraints.html">add_constr_edges_rem</a></span><span class="op">(</span><span class="fu"><a href="redist_constr.html">redist_constr</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  thin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  eprob <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  temper <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  betaseq <span class="op">=</span> <span class="st">"powerlaw"</span>,</span>
<span>  betaseqlength <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  betaweights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  adapt_lambda <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  adapt_eprob <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  exact_mh <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  adjswaps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  init_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">nthin</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-map">map<a class="anchor" aria-label="anchor" href="#arg-map"></a></dt>
<dd><p>A <code><a href="redist_map.html">redist_map</a></code> object.</p></dd>


<dt id="arg-nsims">nsims<a class="anchor" aria-label="anchor" href="#arg-nsims"></a></dt>
<dd><p>The number of samples to draw, not including warmup.</p></dd>


<dt id="arg-warmup">warmup<a class="anchor" aria-label="anchor" href="#arg-warmup"></a></dt>
<dd><p>The number of warmup samples to discard.</p></dd>


<dt id="arg-init-plan">init_plan<a class="anchor" aria-label="anchor" href="#arg-init-plan"></a></dt>
<dd><p>A vector containing the congressional district labels
of each geographic unit. The default is <code>NULL</code>. If not provided,
a random initial plan will be generated using <code>redist_smc</code>. You can also
request to initialize using <code>redist.rsg</code> by supplying 'rsg', though this is
not recommended behavior.</p></dd>


<dt id="arg-constraints">constraints<a class="anchor" aria-label="anchor" href="#arg-constraints"></a></dt>
<dd><p>A <code>redist_constr</code> object.</p></dd>


<dt id="arg-thin">thin<a class="anchor" aria-label="anchor" href="#arg-thin"></a></dt>
<dd><p>The amount by which to thin the Markov Chain. The
default is <code>1</code>.</p></dd>


<dt id="arg-eprob">eprob<a class="anchor" aria-label="anchor" href="#arg-eprob"></a></dt>
<dd><p>The probability of keeping an edge connected. The
default is <code>0.05</code>.</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>lambda The parameter determining the number of swaps to attempt
each iteration of the algorithm. The number of swaps each iteration is
equal to Pois(<code>lambda</code>) + 1. The default is <code>0</code>.</p></dd>


<dt id="arg-temper">temper<a class="anchor" aria-label="anchor" href="#arg-temper"></a></dt>
<dd><p>Whether to use simulated tempering algorithm. Default is FALSE.</p></dd>


<dt id="arg-betaseq">betaseq<a class="anchor" aria-label="anchor" href="#arg-betaseq"></a></dt>
<dd><p>Sequence of beta values for tempering. The default is
<code>powerlaw</code> (see Fifield et. al (2020) for details).</p></dd>


<dt id="arg-betaseqlength">betaseqlength<a class="anchor" aria-label="anchor" href="#arg-betaseqlength"></a></dt>
<dd><p>Length of beta sequence desired for
tempering. The default is <code>10</code>.</p></dd>


<dt id="arg-betaweights">betaweights<a class="anchor" aria-label="anchor" href="#arg-betaweights"></a></dt>
<dd><p>betaweights Sequence of weights for different values of
beta. Allows the user to upweight certain values of beta over
others. The default is <code>NULL</code> (equal weighting).</p></dd>


<dt id="arg-adapt-lambda">adapt_lambda<a class="anchor" aria-label="anchor" href="#arg-adapt-lambda"></a></dt>
<dd><p>adapt_lambda Whether to adaptively tune the lambda parameter so that the Metropolis-Hastings
acceptance probability falls between 20% and 40%. Default is FALSE.</p></dd>


<dt id="arg-adapt-eprob">adapt_eprob<a class="anchor" aria-label="anchor" href="#arg-adapt-eprob"></a></dt>
<dd><p>eprob Whether to adaptively tune the edgecut probability parameter so that the
Metropolis-Hastings acceptance probability falls between 20% and 40%. Default is
FALSE.</p></dd>


<dt id="arg-exact-mh">exact_mh<a class="anchor" aria-label="anchor" href="#arg-exact-mh"></a></dt>
<dd><p>Whether to use the approximate (FALSE) or exact (TRUE)
Metropolis-Hastings ratio calculation for accept-reject rule. Default is FALSE.</p></dd>


<dt id="arg-adjswaps">adjswaps<a class="anchor" aria-label="anchor" href="#arg-adjswaps"></a></dt>
<dd><p>Flag to restrict swaps of beta so that only
values adjacent to current constraint are proposed. The default is
<code>TRUE</code>.</p></dd>


<dt id="arg-init-name">init_name<a class="anchor" aria-label="anchor" href="#arg-init-name"></a></dt>
<dd><p>a name for the initial plan, or <code>FALSE</code> to not include
the initial plan in the output.  Defaults to the column name of the
existing plan, or "<code>&lt;init&gt;</code>" if the initial plan is sampled.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Whether to print initialization statement. Default is <code>TRUE</code>.</p></dd>


<dt id="arg-nthin">nthin<a class="anchor" aria-label="anchor" href="#arg-nthin"></a></dt>
<dd><p>Deprecated. Use <code>thin</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code><a href="redist_plans.html">redist_plans</a></code> object containing the simulated plans.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>redist_flip</code> allows for Gibbs constraints to be supplied via a list object
passed to <code>constraints</code>.
<code>redist_flip</code> uses a small compactness constraint by default, as this improves
the realism of the maps greatly and also leads to large speed improvements.
(One of the most time consuming aspects of the flip MCMC backend is checking for
district shattering, which is slowed down even further by non-compact districts.
As such, it is recommended that all flip simulations use at least a minimal compactness
constraint, even if you weaken it from the default settings.) The default is
a <code>compact</code> constraint using the <code>edges-removed</code> metric with a
weight of 0.6. For very small maps (&lt; 100 precincts), you will likely want to
weaken (lower) this constraint, while for very large maps (&gt; 5000 precincts),
you will likely want to strengthen (increase) this constraint. Otherwise,
for most maps, the default constraint should be a good starting place.</p>
<p><code>redist_flip</code> samples from a known target distribution which can be described
using the <code>constraints</code>. The following describes the constraints available. The general
advice is to set weights in a way that gets between 20% and 40% acceptance
on average, though more tuning advice is available in the vignette on using
MCMC methods.Having too small of an acceptance rate indicates that the weights
within <code>constraints</code> are too large and will impact sampling efficiency.
If the Metropolis Hastings acceptance rate is too large, this may impact the
target distribution, but may be fine for general exploration of possible maps.</p>
<p>There are currently 9 implemented constraint types, though `<code>compact</code> and
<code>partisan</code> have sub-types which are specified via a character <code>metric</code>
within their respective list objects. The constraints are as follows:</p><ul><li><p><code>compact</code> - biases the algorithm towards drawing more compact districts.</p></li>
<li><p>weight - the coefficient to put on the Gibbs constraint</p></li>
<li><p>metric - which metric to use. Must be one of <code>edges-removed</code> (the default),
<code>polsby-popper</code>, <code>fryer-holden</code>, or <code>log-st</code>. Using Polsby Popper
is generally not recommended, as <code>edges-removed</code> is faster and highly correlated.
<code>log-st</code> can be used to match the target distribution of <code>redist_smc</code> or
<code>redist_mergesplit</code>.</p></li>
<li><p>areas - Only used with <code>polsby-popper</code> - A vector of precinct areas.</p></li>
<li><p>borderlength_mat - Only used with <code>polsby-popper</code> - A matrix of precinct
border lengths.</p></li>
<li><p>ssdmat - Only used with <code>fryer-holden</code> - A matrix of squared distances between
precinct centroids.</p></li>
<li><p>ssd_denom - Only used with <code>fryer-holden</code> - a positive integer to use
as the normalizing constant for the Relative Proximity Index.</p></li>
<li><p><code>population</code> - A Gibbs constraint to complement the hard population
constraint set by <code>pop_tol</code>. This penalizes moves which move away from smaller
population parity deviations. It is very useful when an <code>init_plan</code> sits
outside of the desired <code>pop_tol</code> but there are substantive reasons to use
that plan. This constraint uses the input to <code>total_pop</code>.</p></li>
<li><p>weight - the coefficient to put on the Gibbs constraint</p></li>
<li><p><code>countysplit</code> This is a Gibbs constraint to minimize county splits. Unlike
SMC's county constraint, this allows for more than <code>ndists - 1</code> splits and
does not require that counties are contiguous.</p></li>
<li><p>weight - the coefficient to put on the Gibbs constraint</p></li>
<li><p><code>hinge</code> This uses the proportion of a group in a district and matches to the
nearest target proportion, and then creates a penalty of
\(\sqrt{max(0, nearest.target - group.pct)}\).</p></li>
<li><p>weight - the coefficient to put on the Gibbs constraint</p></li>
<li><p>minorityprop - A numeric vector of minority proportions (between 0 and 1) which
districts should aim to have</p></li>
<li><p><code>vra</code> This takes two target proportions of the presence of a minority group
within a district. \((|target.min - group.pct||target.other - group.pct|)^{1.5})\)</p></li>
<li><p>weight - the coefficient to put on the Gibbs constraint</p></li>
<li><p>target_min - the target minority percentage. Often, this is set to 0.55 to encourage
minority majority districts.</p></li>
<li><p>target_other - the target minority percentage for non majority minority districts.</p></li>
<li><p><code>minority</code> This constraint sorts the districts by the proportion of a group in
a district and compares the highest districts to the entries of minorityprop.
This takes the form \(\sum_{i=1}^{n} \sqrt{|group.pct(i) - minorityprop(i)| }\) where n
is the length of minorityprop input.</p></li>
<li><p>weight - the coefficient to put on the Gibbs constraint</p></li>
<li><p>minorityprop - A numeric vector of minority proportions (between 0 and 1) which
districts should aim to have</p></li>
<li><p><code>similarity</code> This is a status-quo constraint which penalizes plans which
are very different from the starting place. It is useful for local exploration.</p></li>
<li><p>weight - the coefficient to put on the Gibbs constraint</p></li>
<li><p><code>partisan</code> This is a constraint which minimizes partisan bias, either as
measured as the difference from proportional representation or as the magnitude of
the efficiency gap.</p></li>
<li><p>weight - the coefficient to put on the Gibbs constraint</p></li>
<li><p>rvote - An integer vector of votes for Republicans or other party</p></li>
<li><p>dvote - An integer vector of votes for Democrats or other party</p></li>
<li><p>metric - which metric to use. Must be one of <code>proportional-representation</code>
or <code>efficiency-gap</code>.</p></li>
<li><p><code>segregation</code> This constraint attempts to minimize the degree of dissimilarity
between districts by group population.</p></li>
<li><p>weight - the coefficient to put on the Gibbs constraint</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Fifield, B., Higgins, M., Imai, K., &amp; Tarr, A. (2020). Automated
redistricting simulation using Markov chain Monte Carlo. <em>Journal of
Computational and Graphical Statistics</em>, 29(4), 715-728.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iowa</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">iowa_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="redist_map.html">redist_map</a></span><span class="op">(</span><span class="va">iowa</span>, ndists <span class="op">=</span> <span class="fl">4</span>, existing_plan <span class="op">=</span> <span class="va">cd_2010</span>, total_pop <span class="op">=</span> <span class="va">pop</span>,</span></span>
<span class="r-in"><span>    pop_tol <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu">redist_flip</span><span class="op">(</span>map <span class="op">=</span> <span class="va">iowa_map</span>, nsims <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="color: #BB0000; font-weight: bold;">redist_flip()</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="color: #BB0000; font-weight: bold;">Automated Redistricting Simulation Using Markov Chain Monte Carlo</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Preprocessing data.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Starting swMH().</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher T. Kenny, Cory McCartan, Ben Fifield, Kosuke Imai.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

