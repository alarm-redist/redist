<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Projective Distributions, Averages, and Contrasts for a Summary Statistic — proj • redist</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Projective Distributions, Averages, and Contrasts for a Summary Statistic — proj"><meta name="description" content="The projective distribution of a district-level summary statistic (McCartan
2024) is the distribution of values of that statistic across a set of plans
for the district each precinct belongs to. The projective average of a
statistic is the average value of the projective distribution in each
precinct. A projective contrast is the difference between the projective
average for a single plan and the projective average for an ensemble of
sampled plans.
It is very important to properly account for variation in the projective
distribution when looking at projective contrasts. The pfdr argument to
proj_contr() will calculate q-values for each precinct that can be used to
control the positive false discovery rate (pFDR) to avoid being misled by
this variation. See redist.plot.contr_pfdr() for a way to automatically
plot projective contrasts with this false discovery rate control."><meta property="og:description" content="The projective distribution of a district-level summary statistic (McCartan
2024) is the distribution of values of that statistic across a set of plans
for the district each precinct belongs to. The projective average of a
statistic is the average value of the projective distribution in each
precinct. A projective contrast is the difference between the projective
average for a single plan and the projective average for an ensemble of
sampled plans.
It is very important to properly account for variation in the projective
distribution when looking at projective contrasts. The pfdr argument to
proj_contr() will calculate q-values for each precinct that can be used to
control the positive false discovery rate (pFDR) to avoid being misled by
this variation. See redist.plot.contr_pfdr() for a way to automatically
plot projective contrasts with this false discovery rate control."><meta property="og:image" content="http://alarm-redist.org/redist/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">redist</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/redist.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/common_args.html">Common Arguments to `redist` Functions</a></li>
    <li><a class="dropdown-item" href="../articles/flip.html">Redistricting with Flip MCMC</a></li>
    <li><a class="dropdown-item" href="../articles/map-preproc.html">Map Pre-processing for Special Constraints</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://alarm-redist.github.io/posts/2021-04-02-redist-300/">redist 3.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/alarm-redist/redist/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate Projective Distributions, Averages, and Contrasts for a Summary Statistic</h1>
      <small class="dont-index">Source: <a href="https://github.com/alarm-redist/redist/blob/main/R/proj.R" class="external-link"><code>R/proj.R</code></a></small>
      <div class="d-none name"><code>proj.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <em>projective distribution</em> of a district-level summary statistic (McCartan
2024) is the distribution of values of that statistic across a set of plans
for the district each precinct belongs to. The <em>projective average</em> of a
statistic is the average value of the projective distribution in each
precinct. A <em>projective contrast</em> is the difference between the projective
average for a single plan and the projective average for an ensemble of
sampled plans.</p>
<p>It is very important to properly account for variation in the projective
distribution when looking at projective contrasts. The <code>pfdr</code> argument to
<code>proj_contr()</code> will calculate q-values for each precinct that can be used to
control the positive false discovery rate (pFDR) to avoid being misled by
this variation. See <code><a href="redist.plot.contr_pfdr.html">redist.plot.contr_pfdr()</a></code> for a way to automatically
plot projective contrasts with this false discovery rate control.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">proj_distr</span><span class="op">(</span><span class="va">plans</span>, <span class="va">x</span>, draws <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">proj_avg</span><span class="op">(</span><span class="va">plans</span>, <span class="va">x</span>, draws <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">proj_contr</span><span class="op">(</span><span class="va">plans</span>, <span class="va">x</span>, compare <span class="op">=</span> <span class="cn">NA</span>, draws <span class="op">=</span> <span class="cn">NA</span>, norm <span class="op">=</span> <span class="cn">FALSE</span>, pfdr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-plans">plans<a class="anchor" aria-label="anchor" href="#arg-plans"></a></dt>
<dd><p>A <a href="redist_plans.html">redist_plans</a> object.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A district-level summary statistic calculated from the <code>plans</code>
object. Tidy-evaluated in <code>plans</code>.</p></dd>


<dt id="arg-draws">draws<a class="anchor" aria-label="anchor" href="#arg-draws"></a></dt>
<dd><p>which draws/samples to include in the projective distribution.
<code>NULL</code> will include all draws, including reference plans. The special value
<code>NA</code> will include all sampled (non-reference) draws. An integer, logical,
or character vector indicating specific draws may also be provided.</p></dd>


<dt id="arg-compare">compare<a class="anchor" aria-label="anchor" href="#arg-compare"></a></dt>
<dd><p>The plan to compare to the rest of the ensemble (which is
controlled by <code>draws</code>). Defaults to the first reference plan, if any exists</p></dd>


<dt id="arg-norm">norm<a class="anchor" aria-label="anchor" href="#arg-norm"></a></dt>
<dd><p>If <code>TRUE</code>, normalize the contrast by the standard deviation of
the projective distribution, precinct-wise. This will make the projective
contrast in terms of z-scores.</p></dd>


<dt id="arg-pfdr">pfdr<a class="anchor" aria-label="anchor" href="#arg-pfdr"></a></dt>
<dd><p>If <code>TRUE</code>, calculate q-values for each precinct that can be
used to control the positive false discovery rate (pFDR) at a given level
by thresholding the q-values at that level. Q-values are stored as the
<code>"q"</code> attribute on the returned vector. Requires the <code>matrixStats</code> package
be installed.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>proj_distr</code>: A matrix with a row for each precinct (row in the map
object) and a column for every draw described by <code>draws</code>.</p>
<p><code>proj_avg</code>: A numeric vector of length matching the number of
precincts.</p>
<p><code>proj_contr</code>: A numeric vector of length matching the number of
precincts, optionally with a <code>"q"</code> attribute containing q-values.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>McCartan, C. (2024). Projective Averages for Summarizing Redistricting
Ensembles. <em>arXiv preprint</em>. Available at <a href="https://arxiv.org/pdf/2401.06381" class="external-link">https://arxiv.org/pdf/2401.06381</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iowa</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="redist_map.html">redist_map</a></span><span class="op">(</span><span class="va">iowa</span>, existing_plan <span class="op">=</span> <span class="va">cd_2010</span>, pop_tol <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">plans</span> <span class="op">&lt;-</span> <span class="fu"><a href="redist_smc.html">redist_smc</a></span><span class="op">(</span><span class="va">map</span>, <span class="fl">50</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">plans</span><span class="op">$</span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="redist.group.percent.html">group_frac</a></span><span class="op">(</span><span class="va">map</span>, <span class="va">dem_08</span>, <span class="va">tot_08</span>, <span class="va">plans</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">proj_distr</span><span class="op">(</span><span class="va">plans</span>, <span class="va">dem</span><span class="op">)</span><span class="op">[</span> ,<span class="fl">1</span><span class="op">]</span> <span class="co"># a 99-by-50 matrix, just showing first column</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.4545314 0.4545314 0.5528518 0.5528518 0.4545314 0.5528518 0.5528518</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8] 0.5395505 0.5528518 0.6058231 0.4545314 0.5528518 0.4545314 0.5395505</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] 0.4545314 0.6058231 0.5528518 0.4545314 0.5528518 0.4545314 0.4545314</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [22] 0.6058231 0.6058231 0.4545314 0.5395505 0.5528518 0.4545314 0.6058231</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] 0.5528518 0.4545314 0.6058231 0.4545314 0.5528518 0.5528518 0.5395505</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [36] 0.4545314 0.5395505 0.5528518 0.5395505 0.4545314 0.4545314 0.5395505</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [43] 0.4545314 0.5528518 0.5528518 0.4545314 0.4545314 0.5528518 0.6058231</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [50] 0.5395505 0.5528518 0.6058231 0.6058231 0.5528518 0.4545314 0.5528518</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [57] 0.6058231 0.5528518 0.4545314 0.4545314 0.4545314 0.5528518 0.5395505</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [64] 0.5528518 0.4545314 0.5528518 0.4545314 0.5528518 0.4545314 0.5528518</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [71] 0.4545314 0.4545314 0.4545314 0.4545314 0.4545314 0.4545314 0.5395505</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [78] 0.4545314 0.5528518 0.4545314 0.5395505 0.6058231 0.4545314 0.4545314</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [85] 0.5395505 0.5528518 0.4545314 0.4545314 0.5528518 0.5528518 0.4545314</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [92] 0.5528518 0.4545314 0.4545314 0.4545314 0.5528518 0.4545314 0.5528518</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [99] 0.4545314</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map</span>, <span class="fu">proj_avg</span><span class="op">(</span><span class="va">plans</span>, <span class="va">dem</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="proj-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map</span>, <span class="fu">proj_contr</span><span class="op">(</span><span class="va">plans</span>, <span class="va">dem</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="proj-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map</span>, <span class="fu">proj_contr</span><span class="op">(</span><span class="va">plans</span>, <span class="va">dem</span>, compare<span class="op">=</span><span class="st">"cd_2010"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="proj-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher T. Kenny, Cory McCartan, Ben Fifield, Kosuke Imai.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

