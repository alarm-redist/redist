<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulation Methods for Legislative Redistricting • redist</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Simulation Methods for Legislative Redistricting">
<meta property="og:description" content="Enables researchers to sample redistricting plans from a pre-specified
    target distribution using Sequential Monte Carlo and Markov Chain Monte Carlo
    algorithms.  The package allows for the implementation of various constraints in
    the redistricting process such as geographic compactness and population parity
    requirements. Tools for analysis such as computation of various summary statistics
    and plotting functionality are also included. The package implements methods
    described in Fifield, Higgins, Imai and Tarr (2020) &lt;doi: 10.1080/10618600.2020.1739532&gt;,
    Fifield, Imai, Kawahara, and Kenny (2020) &lt;doi: 10.1080/2330443X.2020.1791773&gt;,
    and McCartan and Imai (2020) &lt;arXiv: 2008.06131&gt;.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">redist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/Intro-to-redist.html">Intro-to-redist</a>
    </li>
    <li>
      <a href="articles/tidy-redist.html">Tidy `redist`</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kosukeimai/redist/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="redist-simulation-methods-for-legislative-redistricting" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#redist-simulation-methods-for-legislative-redistricting" class="anchor"></a>redist: Simulation Methods for Legislative Redistricting</h1></div>
<!-- badges: start -->

<p>This R package enables researchers to sample redistricting plans from a pre-specified target distribution using Sequential Monte Carlo and Markov Chain Monte Carlo algorithms. The package allows for the implementation of various constraints in the redistricting process such as geographic compactness and population parity requirements. Tools for analysis such as computation of various summary statistics and plotting functionality are also included. The package implements methods described in Fifield, Higgins, Imai and Tarr (2020) &lt;doi: 10.1080/10618600.2020.1739532&gt;, Fifield, Imai, Kawahara, and Kenny (2020) &lt;doi: 10.1080/2330443X.2020.1791773&gt;, and McCartan and Imai (2020) &lt;arXiv: 2008.06131&gt;.</p>
<p>Authors:</p>
<ul>
<li>
<a href="https://www.benfifield.com">Ben Fifield</a>, <a href="mailto:benfifield@gmail.com" class="email">benfifield@gmail.com</a> (Maintainer)</li>
<li>
<a href="https://www.christophertkenny.com">Christopher T Kenny</a>, <a href="mailto:christopherkenny@fas.harvard.edu" class="email">christopherkenny@fas.harvard.edu</a>
</li>
<li>Cory McCartan, <a href="mailto:cmccartan@g.harvard.edu" class="email">cmccartan@g.harvard.edu</a>
</li>
<li>Alex Tarr, <a href="mailto:atarr@princeton.edu" class="email">atarr@princeton.edu</a>
</li>
<li>Jun Kawahara, <a href="mailto:jkawahara@i.kyoto-u.ac.jp" class="email">jkawahara@i.kyoto-u.ac.jp</a>
</li>
<li>
<a href="https://imai.fas.harvard.edu">Kosuke Imai</a>, <a href="mailto:imai@harvard.edu" class="email">imai@harvard.edu</a>
</li>
</ul>
<p>Contributors:</p>
<ul>
<li>
<a href="http://www-personal.k-state.edu/~mikehiggins/">Michael Higgins</a>, <a href="mailto:mjh5@princeton.edu" class="email">mjh5@princeton.edu</a>
</li>
</ul>
<p>Papers:</p>
<ul>
<li>
<a href="https://doi.org/10.1080/10618600.2020.1739532">Automated Redistricting Simulation Using Markov Chain Monte Carlo</a> <em>Journal of Computational and Graphical Statistics</em>
</li>
<li>
<a href="https://doi.org/10.1080/2330443X.2020.1791773">The Essential Role of Empirical Validation in Legislative Redistricting Simulation</a> <em>Statistics and Public Policy</em> Vol. 7, No. 1, pp. 52-68.</li>
<li><a href="https://arxiv.org/pdf/2008.06131.pdf">Sequential Monte Carlo for Sampling Balanced and Compact Redistricting Plans</a></li>
</ul>
<div id="installation-instructions" class="section level2">
<h2 class="hasAnchor">
<a href="#installation-instructions" class="anchor"></a>Installation Instructions</h2>
<p><code>redist</code> is available on CRAN and can be installed using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"redist"</span><span class="op">)</span></code></pre></div>
<p>You can also install the most recent development version of <code>redist</code> using the <code>devtools</code> package. First you have to install <code>devtools</code> using the following code. Note that you only have to do this once:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></code></pre></div>
<p>Then, load <code>devtools</code> and use the function <code><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github()</a></code> to install <code>redist</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"kosukeimai/redist"</span>,dependencies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="usage-by-other-people" class="section level1">
<h1 class="hasAnchor">
<a href="#usage-by-other-people" class="anchor"></a>Usage by Other People</h1>
<p><a href="https://www.r-bloggers.com/2021/02/some-computational-redistricting-methods-or-how-to-sniff-out-a-gerrymander-in-a-pinch/">New Mexico</a> <a href="https://www.benjaminsorensen.me/post/mt-redistricting/">Montana</a></p>
</div>
<div id="usage-examples---25-precincts-into-3-districts" class="section level1">
<h1 class="hasAnchor">
<a href="#usage-examples---25-precincts-into-3-districts" class="anchor"></a>Usage Examples - 25 Precincts into 3 Districts</h1>
<div id="no-population-constraint" class="section level2">
<h2 class="hasAnchor">
<a href="#no-population-constraint" class="anchor"></a>No Population Constraint</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">redist</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">algdat.pfull</span><span class="op">)</span>

<span class="co">## Run the simulations</span>
<span class="va">mcmc.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redist.mcmc.html">redist.mcmc</a></span><span class="op">(</span>adjobj <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">adjlist</span>,
                        popvec <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
                        nsims <span class="op">=</span> <span class="fl">10000</span>,
                        ndists <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
</div>
<div id="20-population-constraint" class="section level2">
<h2 class="hasAnchor">
<a href="#20-population-constraint" class="anchor"></a>20% Population Constraint</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">algdat.p20</span><span class="op">)</span>

<span class="co">## -----------------------------------------------</span>
<span class="co">## Run mcmc algorithm - hard population constraint</span>
<span class="co">## (reject any sample where population parity &gt; 20%)</span>
<span class="co">## -----------------------------------------------</span>
<span class="va">mcmc.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redist.mcmc.html">redist.mcmc</a></span><span class="op">(</span>adjobj <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">adjlist</span>,
                        popvec <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
                        nsims <span class="op">=</span> <span class="fl">10000</span>,
                        popcons <span class="op">=</span> <span class="fl">.2</span>,
                        ndists <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="co">## ---------------------------------------------------------------------</span>
<span class="co">## Run mcmc algorithm - draws from gibbs defined by distance from parity</span>
<span class="co">## (Run with no tempering)</span>
<span class="co">## ---------------------------------------------------------------------</span>
<span class="va">mcmc.out.gb</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redist.mcmc.html">redist.mcmc</a></span><span class="op">(</span>adjobj <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">adjlist</span>,
                           popvec <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
                           ndists <span class="op">=</span> <span class="fl">3</span>,
                           nsims <span class="op">=</span> <span class="fl">10000</span>,
                           constraint <span class="op">=</span> <span class="st">"population"</span>,
                           constraintweights <span class="op">=</span> <span class="fl">5.4</span><span class="op">)</span>
<span class="co">## Reweight draws back to the uniform distribution</span>
<span class="va">mcmc.out.gb</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redist.ipw.html">redist.ipw</a></span><span class="op">(</span><span class="va">mcmc.out.gb</span>, targetpop <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span>

<span class="co">## ---------------------------------------------------------------------</span>
<span class="co">## Run mcmc algorithm - draws from gibbs defined by distance from parity</span>
<span class="co">## (Run with simulated tempering, betas power law sequence of length 10</span>
<span class="co">## from 0 to 1)</span>
<span class="co">## Also including optional beta weights, to upweight prob of transitions</span>
<span class="co">## to colder temperatures</span>
<span class="co">## ---------------------------------------------------------------------</span>
<span class="va">betaweights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">10</span><span class="op">)</span>; <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">{</span><span class="va">betaweights</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">^</span><span class="va">i</span><span class="op">}</span>
<span class="va">mcmc.out.st</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redist.mcmc.html">redist.mcmc</a></span><span class="op">(</span>adjobj <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">adjlist</span>,
                           popvec <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
                           ndists <span class="op">=</span> <span class="fl">3</span>,
                           nsims <span class="op">=</span> <span class="fl">10000</span>,
                           constraint <span class="op">=</span> <span class="st">"population"</span>,
                           constraintweights <span class="op">=</span> <span class="fl">5.4</span>,
                           temper <span class="op">=</span> <span class="cn">TRUE</span>,
                           betaweights <span class="op">=</span> <span class="va">betaweights</span><span class="op">)</span>
<span class="va">mcmc.out.st</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redist.ipw.html">redist.ipw</a></span><span class="op">(</span><span class="va">mcmc.out.st</span>, targetpop <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span></code></pre></div>
</div>
<div id="20-population-constraint-and-compactness-constraint" class="section level2">
<h2 class="hasAnchor">
<a href="#20-population-constraint-and-compactness-constraint" class="anchor"></a>20% Population Constraint and Compactness Constraint</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## ----------------------------------------------------------</span>
<span class="co">## Constrain on population and compactness with tempering,</span>
<span class="co">## weight on population = 5.4 while weight on compactness = 3</span>
<span class="co">## Also specifying argument for ssdmat, the distance matrix</span>
<span class="co">## ----------------------------------------------------------</span>
<span class="va">mcmc.out.st.multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redist.mcmc.html">redist.mcmc</a></span><span class="op">(</span>adjobj <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">adjlist</span>,
                                    popvec <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
                                    ndists <span class="op">=</span> <span class="fl">3</span>,
                                    nsims <span class="op">=</span> <span class="fl">10000</span>,
                                    constraint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"population"</span>, <span class="st">"compact"</span><span class="op">)</span>,
                                    constraintweights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">3</span><span class="op">)</span>,
                                    ssdmat <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">distancemat</span>,
                                    temper <span class="op">=</span> <span class="cn">TRUE</span>,
                                    betaweights <span class="op">=</span> <span class="va">betaweights</span><span class="op">)</span>
<span class="va">mcmc.out.st</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redist.ipw.html">redist.ipw</a></span><span class="op">(</span><span class="va">mcmc.out.st.multiple</span>, targetpop <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span></code></pre></div>
</div>
<div id="20-population-constraint-and-compactness-constraint-using-mpi" class="section level2">
<h2 class="hasAnchor">
<a href="#20-population-constraint-and-compactness-constraint-using-mpi" class="anchor"></a>20% Population Constraint and Compactness Constraint, using MPI</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## ----------------------------------------------------------</span>
<span class="co">## Constrain on population and compactness with parallel tempering,</span>
<span class="co">## weight on population = 5.4 while weight on compactness = 3</span>
<span class="co">## Also specifying argument for ssdmat, the distance matrix.</span>
<span class="co">## In addition, specifying a 20-beta tempering ladder.</span>
<span class="co">## Save file as "redist_mpi.RData"</span>
<span class="co">## ----------------------------------------------------------</span>
<span class="fu"><a href="reference/redist.mcmc.mpi.html">redist.mcmc.mpi</a></span><span class="op">(</span>
  adjobj <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">adjlist</span>,
  popvec <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
  ndists <span class="op">=</span> <span class="fl">3</span>,
  nsims <span class="op">=</span> <span class="fl">10000</span>,
  constraint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"population"</span>, <span class="st">"compact"</span><span class="op">)</span>,
  constraintweights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">3</span><span class="op">)</span>,
  ssdmat <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">distancemat</span>,
  betaseqlength <span class="op">=</span> <span class="fl">20</span>,
  savename <span class="op">=</span> <span class="st">"redist_mpi"</span>,
  verbose <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co">## Note that reweighting using redist.ipw() currently</span>
<span class="co">## has to happen in a separate analysis file after</span>
<span class="co">## redist.mcmc.mpi() is run and the output file is saved. </span>
<span class="co">## We will change this in a future release to run the </span>
<span class="co">## inverse probability reweighting inside of</span>
<span class="co">## redist.mcmc.mpi().</span></code></pre></div>
<div id="a-sample-slurm-script-for-submitting-mpi-jobs" class="section level3">
<h3 class="hasAnchor">
<a href="#a-sample-slurm-script-for-submitting-mpi-jobs" class="anchor"></a>A Sample slurm Script for Submitting MPI Jobs</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ----------------------------------------------------------</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Sample slurm script for submitting an R script using </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">## redist.mcmc.mpi(). Set ntasks equal to the length of the</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">## beta sequence ladder plus one extra core.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">## ----------------------------------------------------------</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --ntasks=21</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=1</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -t 02:00:00</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -J [jobname here]</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -o log.%j</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mail-type=begin</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mail-type=end</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">'-------------------------------'</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="va">${SLURM_SUBMIT_DIR}</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">${SLURM_SUBMIT_DIR}</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Running on host <span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Time is <span class="va">$(</span><span class="fu">date</span><span class="va">)</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> SLURM_NODES are <span class="va">$(</span><span class="bu">echo</span> <span class="va">${SLURM_NODELIST})</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">'-------------------------------'</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> -e <span class="st">'\n\n'</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="ex">mpiexec</span> -np 1 R --no-save <span class="op">&lt;</span> [scriptname here].R</span></code></pre></div>
</div>
</div>
<div id="20-population-constraint-and-compactness-constraint-using-annealing" class="section level2">
<h2 class="hasAnchor">
<a href="#20-population-constraint-and-compactness-constraint-using-annealing" class="anchor"></a>20% Population Constraint and Compactness Constraint, using Annealing</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## ----------------------------------------------------------</span>
<span class="co">## Constrain on population and compactness with annealing,</span>
<span class="co">## weight on population = 5.4 while weight on compactness = 3</span>
<span class="co">## Also specifying argument for ssdmat, the distance matrix.</span>
<span class="co">## In addition, specifying a 20-beta tempering ladder.</span>
<span class="co">## Save file as "redist_anneal_[t].RData", where t is the</span>
<span class="co">## SLURM array number. </span>
<span class="co">## </span>
<span class="co">## In addition, we no longer specify a "sims" argument. </span>
<span class="co">## This temperature schedule involves simulating at the "hot"</span>
<span class="co">## temperature (beta = 0) for 500 steps ("num_hot_steps"),</span>
<span class="co">## then taking a linear annealing temperature schedule for</span>
<span class="co">## 2000 steps ("num_annealing_steps"), and finally simulating</span>
<span class="co">## at the cold temperature (beta = 1) for 500 steps ("num_cold_steps").</span>
<span class="co">## Finally, we take the last draw of the algorithm and store it as output.</span>
<span class="co">## ----------------------------------------------------------</span>

<span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"SLURM_ARRAY_TASK_ID"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="reference/redist.mcmc.anneal.html">redist.mcmc.anneal</a></span><span class="op">(</span>
  adjobj <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">adjlist</span>,
  popvec <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
  ndists <span class="op">=</span> <span class="fl">3</span>,
  num_hot_steps <span class="op">=</span> <span class="fl">500</span>, num_annealing_steps <span class="op">=</span> <span class="fl">2000</span>, num_cold_steps <span class="op">=</span> <span class="fl">500</span>,
  constraint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"population"</span>, <span class="st">"compact"</span><span class="op">)</span>,
  constraintweights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5.4</span>, <span class="fl">3</span><span class="op">)</span>,
  ssdmat <span class="op">=</span> <span class="va">algdat.p20</span><span class="op">$</span><span class="va">distancemat</span>,
  savename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"redist_anneal_"</span>, <span class="va">t</span><span class="op">)</span>
<span class="op">)</span>

<span class="co">## ----------------------------------------------------</span>
<span class="co">## Note that reweighting using redist.ipw() currently</span>
<span class="co">## has to happen in a separate analysis file after</span>
<span class="co">## redist.mcmc.anneal() is run and the output file is saved. </span>
<span class="co">## Below is sample code for combining multiple runs of</span>
<span class="co">## redist.mcmc.anneal() back together, which should be run </span>
<span class="co">## in a separate script. We can then run redist.ipw()</span>
<span class="co">## on the combined simulations.</span>
<span class="co">## ----------------------------------------------------</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="st">"[directory with files]"</span><span class="op">)</span>
<span class="va">algout</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redist.combine.anneal.html">redist.combine.anneal</a></span><span class="op">(</span><span class="st">"redist_anneal_"</span><span class="op">)</span>
<span class="va">algout_rw</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redist.ipw.html">redist.ipw</a></span><span class="op">(</span><span class="va">algout</span>, targetpop <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span></code></pre></div>
<div id="a-sample-slurm-script-for-submitting-annealing-jobs" class="section level3">
<h3 class="hasAnchor">
<a href="#a-sample-slurm-script-for-submitting-annealing-jobs" class="anchor"></a>A Sample slurm Script for Submitting Annealing Jobs</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">## ----------------------------------------------------------</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Sample slurm script for submitting an R script using </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">## redist.mcmc.anneal(). Set array equal to the number</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">## of desired draws, although your slurm setup may cap</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">## the number of array jobs you can run at once. Here,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">## we are requesting 1000 simulations.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">## ----------------------------------------------------------</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --ntasks=1</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=1</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -t 02:00:00</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -J [jobname here]</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH -o log.%j</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mail-type=begin</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mail-type=end</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --array=1-1000</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">'-------------------------------'</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="va">${SLURM_SUBMIT_DIR}</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">${SLURM_SUBMIT_DIR}</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Running on host <span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> Time is <span class="va">$(</span><span class="fu">date</span><span class="va">)</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> SLURM_NODES are <span class="va">$(</span><span class="bu">echo</span> <span class="va">${SLURM_NODELIST})</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">'-------------------------------'</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> -e <span class="st">'\n\n'</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="ex">srun</span> Rscript ../[scriptname here].R</span></code></pre></div>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=redist">https://​cloud.r-project.org/​package=redist</a>
</li>
<li>Browse source code at <br><a href="https://github.com/kosukeimai/redist/">https://​github.com/​kosukeimai/​redist/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/kosukeimai/redist/issues">https://​github.com/​kosukeimai/​redist/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 2)</li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing redist</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Ben Fifield <br><small class="roles"> Author, maintainer </small>  </li>
<li>Christopher T. Kenny <br><small class="roles"> Author </small>  </li>
<li>Cory McCartan <br><small class="roles"> Author </small>  </li>
<li>Jun Kawahara <br><small class="roles"> Author </small>  </li>
<li>Kosuke Imai <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/kosukeimai/redist"><img src="https://travis-ci.org/kosukeimai/redist.svg?branch=master" alt="Build Status"></a></li>
<li><a href="https://cran.r-project.org/package=redist"><img src="https://www.r-pkg.org/badges/version-last-release/redist" alt="CRAN_Status_Badge"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Ben Fifield, Christopher T. Kenny, Cory McCartan, Jun Kawahara, Kosuke Imai.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
