<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to gredist • gredist</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to gredist">
<meta property="og:description" content="gredist">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gredist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/gredist.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/common_args.html">Common Arguments to `gredist` Functions</a>
    </li>
    <li>
      <a href="../articles/flip.html">Redistricting with Flip MCMC</a>
    </li>
    <li>
      <a href="../articles/map-preproc.html">Map Pre-processing for Special Constraints</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li>
      <a href="https://alarm-gredist.github.io/posts/2021-04-02-gredist-300/" class="external-link">gredist 3.0</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/alarm-gredist/gredist/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to gredist</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/alarm-gredist/gredist/blob/HEAD/vignettes/gredist.Rmd" class="external-link"><code>vignettes/gredist.Rmd</code></a></small>
      <div class="hidden name"><code>gredist.Rmd</code></div>

    </div>

    
    
<p>The <code>gredist</code> package provides algorithms and tools for
scalable and replicable redistricting analyses. This vignette introduces
the package by way of an analysis of redistricting in the state of Iowa,
which can broken down into four distinct steps:</p>
<ol style="list-style-type: decimal">
<li><a href="#prepare">Compiling, cleaning, and preparing the
data</a></li>
<li><a href="#define">Defining the redistricting problem</a></li>
<li><a href="#simulate">Simulating redistricting plans</a></li>
<li><a href="#analyze">Analyzing the simulated plans</a></li>
</ol>
<p>First, however, a brief overview of the package itself.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://alarm-gredist.org/gredist/" class="external-link">gredist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="package">The <code>gredist</code> package<a class="anchor" aria-label="anchor" href="#package"></a>
</h2>
<p>To install <code>gredist</code>, follow the instructions in the <a href="../index.html#installation-instructions">README</a>.</p>
<p>For more information on package components, check out the <a href="../reference/index.html">full documentation</a>.</p>
<div class="section level3">
<h3 id="algorithms">Algorithms<a class="anchor" aria-label="anchor" href="#algorithms"></a>
</h3>
<p>The package contains a variety of redistricting simulation and
enumeration algorithms. Generally you will use one of the following
three algorithms:</p>
<ul>
<li>
<code><a href="../reference/redist_smc.html">redist_smc()</a></code>, the recommended algorithm for most
purposes.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</li>
<li>
<code><a href="../reference/redist_mergesplit.html">redist_mergesplit()</a></code>, a MCMC version of the SMC
proposal.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>
</li>
<li>
<code><a href="../reference/redist_flip.html">redist_flip()</a></code>, another MCMC algorithm which uses more
local proposals.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>
</li>
</ul>
<p>The other algorithms are</p>
<ul>
<li>
<code><a href="../reference/gredist.enumpart.html">gredist.enumpart()</a></code> for efficient enumeration of small
maps.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>
</li>
<li>
<code><a href="../reference/redist_shortburst.html">redist_shortburst()</a></code> for optimizing a plan according to
a user-provided criterion.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>
</li>
<li>
<code><a href="../reference/gredist.rsg.html">gredist.rsg()</a></code> and <code><a href="../reference/gredist.crsg.html">gredist.crsg()</a></code>, which do
not sample from a known target distribution.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>The package comes with several built-in datasets, which may be useful
in exploring the package’s functionality and in becoming familiar with
algorithmic redistricting:</p>
<ul>
<li>
<a href="../reference/iowa.html"><code>iowa</code></a> (used in this
vignette).</li>
<li>
<a href="../reference/fl25.html"><code>fl25</code></a>, a
25-precinct subset of the state of Florida.</li>
<li>
<a href="../reference/fl25_enum.html"><code>fl25_enum</code></a>,
containing all possible sets of three districts drawn on the 25-precinct
Florida map.</li>
<li>
<a href="../reference/fl70.html"><code>fl70</code></a>, a
70-precinct subset of the state of Florida.</li>
<li>
<a href="../reference/fl250.html"><code>fl250</code></a>, a
250-precinct subset of the state of Florida.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="prepare">Compiling, cleaning, and preparing the data<a class="anchor" aria-label="anchor" href="#prepare"></a>
</h2>
<p>The most time-consuming part of a redistricting analysis, like most
data analyses, is collecting and cleaning the necessary data. For
redistricting, this data includes geographic shapefiles for precincts
and existing legislative district plans, precinct- or block-level
demographic information from the Census, and precinct-level political
data. These data generally come from different sources, and may not
fully overlap with each other, further complicating the problem.</p>
<p><code>gredist</code> is not focused on this data collection process.
The <a href="https://christophertkenny.com/geomander/" class="external-link"><code>geomander</code></a>
package contains many helpful functions for compiling these data, and
fixing problems in geographic data.</p>
<p>The ALARM project provides <a href="https://alarm-gredist.org/posts/2021-08-10-census-2020/" class="external-link">pre-cleaned
redistricting data files</a> consisting of VEST election data joined
2020 Census data at the precinct level. Other sources for precinct-level
geographic and political information include the <a href="https://electionlab.mit.edu/data" class="external-link">MIT Election Lab</a>, the <a href="https://www.census.gov/programs-surveys/decennial-census/about/rdo.html" class="external-link">Census</a>,
the <a href="https://redistrictingdatahub.org/" class="external-link">Redistricting Data
Hub</a>, the <a href="https://dataverse.harvard.edu/dataverse/electionscience" class="external-link">Voting
and Election Science Team</a>, the <a href="https://dataverse.harvard.edu/dataverse/eda" class="external-link">Harvard Election Data
Archive</a>, the <a href="https://github.com/mggg-states" class="external-link">Metric
Geometry and Gerrymandering Group</a>, and some state websites.</p>
<div class="section level3">
<h3 id="iowa">Iowa<a class="anchor" aria-label="anchor" href="#iowa"></a>
</h3>
<p>For this analysis of Iowa, we’ll use the data included in the
package, which was compiled from the Census and the Harvard Election
Data Archive. It contains, for each county, the total population and
voting-age population by race, as well as the number of votes for
President in 2008. The <code>geometry</code> column contains the
geographic <a href="https://r-spatial.github.io/sf/" class="external-link">shapefile
information</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iowa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">iowa</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 99 features and 15 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 4081849 ymin: 2879102 xmax: 5834228 ymax: 4024957</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83(HARN) / Iowa North (ftUS)</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;     fips       name cd_2010    pop  white black hisp    vap  wvap bvap hvap</span></span>
<span><span class="co">#&gt; 1  19001      Adair       3   7682   7507    11  101   5957  5860    5   53</span></span>
<span><span class="co">#&gt; 2  19003      Adams       3   4029   3922     8   37   3180  3109    6   22</span></span>
<span><span class="co">#&gt; 3  19005  Allamakee       1  14330  13325   109  757  11020 10430   82  425</span></span>
<span><span class="co">#&gt; 4  19007  Appanoose       2  12887  12470    55  181   9993  9745   40   99</span></span>
<span><span class="co">#&gt; 5  19009    Audubon       4   6119   6007     9   37   4780  4714    5   27</span></span>
<span><span class="co">#&gt; 6  19011     Benton       1  26076  25387    93  275  19430 19068   49  155</span></span>
<span><span class="co">#&gt; 7  19013 Black Hawk       1 131090 109968 11493 4907 102594 89541 7677 2865</span></span>
<span><span class="co">#&gt; 8  19015      Boone       4  26306  25194   202  505  20027 19448  103  260</span></span>
<span><span class="co">#&gt; 9  19017     Bremer       1  24276  23459   186  239  18763 18242  155  137</span></span>
<span><span class="co">#&gt; 10 19019   Buchanan       1  20958  20344    59  243  15282 14979   32  128</span></span>
<span><span class="co">#&gt;    tot_08 dem_08 rep_08    region                       geometry</span></span>
<span><span class="co">#&gt; 1    4053   1924   2060     South MULTIPOLYGON (((4592338 328...</span></span>
<span><span class="co">#&gt; 2    2206   1118   1046     South MULTIPOLYGON (((4528041 315...</span></span>
<span><span class="co">#&gt; 3    7059   3971   2965 Northeast MULTIPOLYGON (((5422507 401...</span></span>
<span><span class="co">#&gt; 4    6176   2970   3086     South MULTIPOLYGON (((5032545 306...</span></span>
<span><span class="co">#&gt; 5    3435   1739   1634 Northwest MULTIPOLYGON (((4487363 341...</span></span>
<span><span class="co">#&gt; 6   13712   7058   6447 Southeast MULTIPOLYGON (((5246216 357...</span></span>
<span><span class="co">#&gt; 7   64775  39184  24662 Northeast MULTIPOLYGON (((5175640 369...</span></span>
<span><span class="co">#&gt; 8   13929   7356   6293   Central MULTIPOLYGON (((4741174 354...</span></span>
<span><span class="co">#&gt; 9   12871   6940   5741 Northeast MULTIPOLYGON (((5174636 379...</span></span>
<span><span class="co">#&gt; 10  10338   6050   4139 Northeast MULTIPOLYGON (((5302846 370...</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="define">Defining the redistricting problem<a class="anchor" aria-label="anchor" href="#define"></a>
</h2>
<p>A redistricting problem is defined by the map of the precincts, the
number of contiguous districts to divide the precincts into, the level
of population parity to enforce, and any other necessary constraints
that must be imposed.</p>
<div class="section level3">
<h3 id="determining-the-relevant-constraints">Determining the relevant constraints<a class="anchor" aria-label="anchor" href="#determining-the-relevant-constraints"></a>
</h3>
<p>In Iowa, congressional districts are constructed not out of precincts
but out of the state’s 99 counties, and in the 2010 redistricting cycle,
Iowa was apportioned four congressional districts, down one from the
2000 cycle. Chapter 42 of the Iowa Code provides guidance on the other
constraints imposed on the redistricting process (our emphasis
added):</p>
<blockquote>
<p><strong>42.4 Redistricting standards.</strong></p>
<p>…</p>
<p>1.b. Congressional districts shall each have a population <em>as
nearly equal as practicable</em> to the ideal district population,
derived as prescribed in paragraph “a” of this subsection. No
congressional district shall have a population which varies by more than
<em>one percent from the applicable ideal district population</em>,
except as necessary to comply with Article III, section 37 of the
Constitution of the State of Iowa.</p>
<p>…</p>
<p>3. Districts shall be composed of convenient <em>contiguous
territory</em>. Areas which meet only at the points of adjoining corners
are not contiguous.</p>
<p>4. Districts shall be <em>reasonably compact</em> in form, to the
extent consistent with the standards established by subsections 1, 2,
and 3. In general, reasonably compact districts are those which are
square, rectangular, or hexagonal in shape, and not irregularly shaped,
to the extent permitted by natural or political boundaries….</p>
<p>5. No district shall be drawn for the purpose of favoring a political
party, incumbent legislator or member of Congress, or other person or
group, or for the purpose of augmenting or diluting the voting strength
of a language or racial minority group. In establishing districts,
<em>no use shall be made</em> of any of the following data:</p>
<ol style="list-style-type: lower-alpha">
<li>Addresses of incumbent legislators or members of Congress.</li>
<li>Political affiliations of registered voters.</li>
<li>Previous election results.</li>
<li>Demographic information, other than population head counts, except
as required by the Constitution and the laws of the United States.</li>
</ol>
</blockquote>
<p>The section goes on to provide two specific measures of compactness
that should be used to compare districts, one of which is the total
perimeter of all districts. If the total perimeter is small, then the
districts relatively compact.</p>
<p>Contiguity of districts and no reliance on partisan or demographic
data are built-in to <code>gredist</code>. We’ll look at how to specify
the desired population deviation (no more than 1% by law) in the next
section, and discuss compactness in the <a href="#simulate">simulation
section</a>.</p>
</div>
<div class="section level3">
<h3 id="setting-up-the-problem-in-gredist">Setting up the problem in <code>gredist</code><a class="anchor" aria-label="anchor" href="#setting-up-the-problem-in-gredist"></a>
</h3>
<p>In <code>gredist</code>, a basic redistricting problem is defined by
an object of type <code>redist_map</code>, which can be constructed
using the eponymous function. The user must provide a vector of
population counts (defaults to the <code>pop</code> column, if one
exists) and the desired population parity, and the number of districts.
The latter can be inferred if a reference redistricting plan exists. For
Iowa, we’ll use the adopted 2010 plan as a reference.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iowa_map</span> <span class="op">=</span> <span class="fu"><a href="../reference/redist_map.html">redist_map</a></span><span class="op">(</span><span class="va">iowa</span>, existing_plan<span class="op">=</span><span class="va">cd_2010</span>, pop_tol<span class="op">=</span><span class="fl">0.01</span>, total_pop <span class="op">=</span> <span class="va">pop</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">iowa_map</span><span class="op">)</span></span>
<span><span class="co">#&gt; A <span style="color: #0000BB;">&lt;redist_map&gt;</span> with 99 units and 17 fields</span></span>
<span><span class="co">#&gt; To be partitioned into 4 districts with population between 761,588.8 - 1.0% and 761,588.8 + 1.0%</span></span>
<span><span class="co">#&gt; With geometry:</span></span>
<span><span class="co">#&gt;     bbox:           xmin: 4081849 ymin: 2879102 xmax: 5834228 ymax: 4024957</span></span>
<span><span class="co">#&gt;     projected CRS:  NAD83(HARN) / Iowa North (ftUS)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 99 × 17</span></span></span>
<span><span class="co">#&gt;    fips  name  cd_2010    pop  white black  hisp    vap  wvap  bvap  hvap tot_08</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 19001 Adair       3   <span style="text-decoration: underline;">7</span>682   <span style="text-decoration: underline;">7</span>507    11   101   <span style="text-decoration: underline;">5</span>957  <span style="text-decoration: underline;">5</span>860     5    53   <span style="text-decoration: underline;">4</span>053</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 19003 Adams       3   <span style="text-decoration: underline;">4</span>029   <span style="text-decoration: underline;">3</span>922     8    37   <span style="text-decoration: underline;">3</span>180  <span style="text-decoration: underline;">3</span>109     6    22   <span style="text-decoration: underline;">2</span>206</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 19005 Alla…       1  <span style="text-decoration: underline;">14</span>330  <span style="text-decoration: underline;">13</span>325   109   757  <span style="text-decoration: underline;">11</span>020 <span style="text-decoration: underline;">10</span>430    82   425   <span style="text-decoration: underline;">7</span>059</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 19007 Appa…       2  <span style="text-decoration: underline;">12</span>887  <span style="text-decoration: underline;">12</span>470    55   181   <span style="text-decoration: underline;">9</span>993  <span style="text-decoration: underline;">9</span>745    40    99   <span style="text-decoration: underline;">6</span>176</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 19009 Audu…       4   <span style="text-decoration: underline;">6</span>119   <span style="text-decoration: underline;">6</span>007     9    37   <span style="text-decoration: underline;">4</span>780  <span style="text-decoration: underline;">4</span>714     5    27   <span style="text-decoration: underline;">3</span>435</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 19011 Bent…       1  <span style="text-decoration: underline;">26</span>076  <span style="text-decoration: underline;">25</span>387    93   275  <span style="text-decoration: underline;">19</span>430 <span style="text-decoration: underline;">19</span>068    49   155  <span style="text-decoration: underline;">13</span>712</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 19013 Blac…       1 <span style="text-decoration: underline;">131</span>090 <span style="text-decoration: underline;">109</span>968 <span style="text-decoration: underline;">11</span>493  <span style="text-decoration: underline;">4</span>907 <span style="text-decoration: underline;">102</span>594 <span style="text-decoration: underline;">89</span>541  <span style="text-decoration: underline;">7</span>677  <span style="text-decoration: underline;">2</span>865  <span style="text-decoration: underline;">64</span>775</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 19015 Boone       4  <span style="text-decoration: underline;">26</span>306  <span style="text-decoration: underline;">25</span>194   202   505  <span style="text-decoration: underline;">20</span>027 <span style="text-decoration: underline;">19</span>448   103   260  <span style="text-decoration: underline;">13</span>929</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 19017 Brem…       1  <span style="text-decoration: underline;">24</span>276  <span style="text-decoration: underline;">23</span>459   186   239  <span style="text-decoration: underline;">18</span>763 <span style="text-decoration: underline;">18</span>242   155   137  <span style="text-decoration: underline;">12</span>871</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 19019 Buch…       1  <span style="text-decoration: underline;">20</span>958  <span style="text-decoration: underline;">20</span>344    59   243  <span style="text-decoration: underline;">15</span>282 <span style="text-decoration: underline;">14</span>979    32   128  <span style="text-decoration: underline;">10</span>338</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 89 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: dem_08 &lt;dbl&gt;, rep_08 &lt;dbl&gt;, region &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   geometry &lt;MULTIPOLYGON [US_survey_foot]&gt;, adj &lt;list&gt;</span></span></span></code></pre></div>
<p>This looks much the same as <code>iowa</code> itself, but metadata
has been added, and there’s a new column, <code>adj</code>.</p>
</div>
<div class="section level3">
<h3 id="adjacency-based-redistricting">Adjacency-based redistricting<a class="anchor" aria-label="anchor" href="#adjacency-based-redistricting"></a>
</h3>
<p>All redistricting algorithms operate on an <em>adjacency graph</em>,
which is constructed from the actual precinct or county geography. In
the adjacency graph, every precinct or county is a node, and two nodes
are connected by an edge if the corresponding precincts are
geographically adjacent.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> Creating a contiguous set of districts as
part of a redistricting plan then corresponds to creating a <a href="https://en.wikipedia.org/wiki/Graph_partition" class="external-link"><em>partition</em></a>
of the adjacency graph.</p>
<p>The <code><a href="../reference/redist_map.html">redist_map()</a></code> function automatically computes the
adjacency graph from the provided shapefile (though one can be provided
directly as well), and stores it in the <code>adj</code> column as an
<em>adjacency list</em>, which is, for each precinct, a list of
neighboring precincts. As part of this process, the adjacency graph is
checked for global contiguity (no islands), which is necessary for the
redistricting algorithms to function properly.</p>
<p>We can visualize the adjacency graph by plotting the
<code>redist_map</code> object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">iowa_map</span>, adj<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">iowa_map</span><span class="op">)</span></span></code></pre></div>
<p><img src="redist_files/figure-html/iowa-adj-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="pre-processing">Pre-processing<a class="anchor" aria-label="anchor" href="#pre-processing"></a>
</h3>
<p>Often, we want to only analyze a portion of a map, or hold some
districts fixed while others are re-simulated. We may also want to
implement a status-quo-type constraint that encourages simulated
districts to be close to a reference plan. This can be accomplished by
freezing the “cores” of each district.</p>
<p>All of these operations fall under the umbrella of map
pre-processing, and <code>gredist</code> is well-equipped to handle them.
You can use familiar <code>dplyr</code> verbs like <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code>
and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize()</a></code>, along with new <code>gredist</code>
operations like <code><a href="../reference/gredist.freeze.html">freeze()</a></code>, <code><a href="../reference/gredist.identify.cores.html">make_cores()</a></code>, and
<code><a href="../reference/merge_by.html">merge_by()</a></code>, to operate on <code>redist_map</code> objects.
The package will make the appropriate modifications to the geometry and
adjacency graph in the background.</p>
<p>The <a href="map-preproc.html">map pre-processing vignette</a>
contains more information and examples about these operations.</p>
</div>
<div class="section level3">
<h3 id="exploring-the-geography">Exploring the geography<a class="anchor" aria-label="anchor" href="#exploring-the-geography"></a>
</h3>
<p>To get a feel for the demographic and political geography of the
state, we’ll make some plots from the <code>iowa_map</code> object. We
see that the state is mostly rural and white, with Polk county (Des
Moines) the largest and densest. Politically, most counties are
relatively balanced between Democrats and Republicans (at least in the
’08 election), though there is a rough east-west gradient.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">areas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">iowa_map</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span>, <span class="va">mi</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">iowa_map</span>, fill <span class="op">=</span> <span class="va">pop</span> <span class="op">/</span> <span class="va">areas</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Population density (people / sq. mi)"</span>, </span>
<span>                         trans<span class="op">=</span><span class="st">"sqrt"</span><span class="op">)</span></span></code></pre></div>
<p><img src="redist_files/figure-html/iowa-chloro-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">iowa_map</span>, fill <span class="op">=</span> <span class="va">dem_08</span> <span class="op">/</span> <span class="va">tot_08</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Pct. Democratic '08"</span>,  midpoint<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="redist_files/figure-html/iowa-chloro-2.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">iowa_map</span>, fill <span class="op">=</span> <span class="va">wvap</span> <span class="op">/</span> <span class="va">vap</span>, by_distr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="redist_files/figure-html/iowa-chloro-3.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="simulate">Simulating redistricting plans<a class="anchor" aria-label="anchor" href="#simulate"></a>
</h2>
<p>The crux of a redistricting analysis is actually simulating new
redistricting plans. As discussed above, <code>gredist</code> provides
several algorithms for performing this simulation, and each has its own
advantages and incorporates a different set of constraints. Here, we’ll
demonstrate use of the <code><a href="../reference/redist_smc.html">redist_smc()</a></code> algorithm, a Sequential
Monte Carlo (SMC)-based procedure which is the recommended choice for
most redistricting analyses.</p>
<p>SMC creates plans directly, by drawing district boundaries one at a
time, as illustrated below.</p>
<p><img src="images/smc-schematic.png"></p>
<p>Because of the way districts are drawn in SMC, the generated
districts are relatively compact by default. This can be further
controlled by the <code>compactness</code> parameter (although
<code>compactness=1</code> is particularly computationally
convenient).</p>
<p>To simulate, we call <code><a href="../reference/redist_smc.html">redist_smc()</a></code> on our
<code>redist_map</code> object. We provide the <code>runs=2</code>
parameter, which will run the SMC algorithm twice, in parallel. This
doubles the total number of sampled plans, but more importantly, it
provides extremely valuable diagnostic information about whether the
algorithm is sampling properly.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iowa_plans</span> <span class="op">=</span> <span class="fu"><a href="../reference/redist_smc.html">redist_smc</a></span><span class="op">(</span><span class="va">iowa_map</span>, <span class="fl">500</span>, compactness<span class="op">=</span><span class="fl">1</span>, runs<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The output from the algorithm is a <code>redist_plans</code> object,
which stores a matrix of district assignments for each precinct and
simulated plans, and a table of summary statistics for each district and
simulated plan. The existing 2010 plan has also been automatically added
as a reference plan. Additional reference or comparison plans may be
added using <code><a href="../reference/add_reference.html">add_reference()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">iowa_plans</span><span class="op">)</span></span>
<span><span class="co">#&gt; A <span style="color: #0000BB;">&lt;redist_plans&gt;</span> containing 1,000 sampled plans and 1 reference plan</span></span>
<span><span class="co">#&gt; Plans have 4 districts from a 99-unit map, and were drawn using Sequential</span></span>
<span><span class="co">#&gt; Monte Carlo.</span></span>
<span><span class="co">#&gt; With plans resampled from weights</span></span>
<span><span class="co">#&gt; Plans matrix: int [1:99, 1:1001] 1 1 2 3 4 2 2 4 2 2 ...</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,004 × 4</span></span></span>
<span><span class="co">#&gt;    draw    district total_pop chain</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> cd_2010        1    <span style="text-decoration: underline;">761</span>612    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> cd_2010        2    <span style="text-decoration: underline;">761</span>548    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> cd_2010        3    <span style="text-decoration: underline;">761</span>624    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> cd_2010        4    <span style="text-decoration: underline;">761</span>571    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1              1    <span style="text-decoration: underline;">760</span>836     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1              2    <span style="text-decoration: underline;">757</span>367     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1              3    <span style="text-decoration: underline;">762</span>946     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1              4    <span style="text-decoration: underline;">765</span>206     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2              1    <span style="text-decoration: underline;">756</span>071     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2              2    <span style="text-decoration: underline;">765</span>242     1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3,994 more rows</span></span></span></code></pre></div>
<p>We can explore specific simulated plans with
<code><a href="../reference/gredist.plot.plans.html">gredist.plot.plans()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gredist.plot.plans.html">gredist.plot.plans</a></span><span class="op">(</span><span class="va">iowa_plans</span>, draws<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, shp<span class="op">=</span><span class="va">iowa_map</span><span class="op">)</span></span></code></pre></div>
<p><img src="redist_files/figure-html/ia-sim-plans-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="analyze">Analyzing the simulated plans<a class="anchor" aria-label="anchor" href="#analyze"></a>
</h2>
<p>A <code>redist_plans</code> object, the output of a sampling
algorithm, links a matrix of precinct assignments to a table of district
statistics, and this linkage makes analyzing the output a breeze.</p>
<p>Sometimes it may be useful to renumber the simulated districts (which
have random numbers in general) to match the reference plan as closely
as possible. This adds a <code>pop_overlap</code> column which measures
how much of the population is in the same district in both a given plan
and the reference plan.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iowa_plans</span> <span class="op">=</span> <span class="fu"><a href="../reference/match_numbers.html">match_numbers</a></span><span class="op">(</span><span class="va">iowa_plans</span>, <span class="va">iowa_map</span><span class="op">$</span><span class="va">cd_2010</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">iowa_plans</span><span class="op">)</span></span>
<span><span class="co">#&gt; A <span style="color: #0000BB;">&lt;redist_plans&gt;</span> containing 1,000 sampled plans and 1 reference plan</span></span>
<span><span class="co">#&gt; Plans have 4 districts from a 99-unit map, and were drawn using Sequential</span></span>
<span><span class="co">#&gt; Monte Carlo.</span></span>
<span><span class="co">#&gt; With plans resampled from weights</span></span>
<span><span class="co">#&gt; Plans matrix: int [1:99, 1:1001] 3 3 1 2 4 1 1 4 1 1 ...</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,004 × 5</span></span></span>
<span><span class="co">#&gt;    draw    district total_pop chain pop_overlap</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> cd_2010 1           <span style="text-decoration: underline;">761</span>548    <span style="color: #BB0000;">NA</span>       1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> cd_2010 2           <span style="text-decoration: underline;">761</span>624    <span style="color: #BB0000;">NA</span>       1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> cd_2010 3           <span style="text-decoration: underline;">761</span>612    <span style="color: #BB0000;">NA</span>       1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> cd_2010 4           <span style="text-decoration: underline;">761</span>571    <span style="color: #BB0000;">NA</span>       1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1       1           <span style="text-decoration: underline;">765</span>206     1       0.875</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1       2           <span style="text-decoration: underline;">762</span>946     1       0.875</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1       3           <span style="text-decoration: underline;">757</span>367     1       0.875</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1       4           <span style="text-decoration: underline;">760</span>836     1       0.875</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2       1           <span style="text-decoration: underline;">756</span>071     1       0.691</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2       2           <span style="text-decoration: underline;">765</span>242     1       0.691</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3,994 more rows</span></span></span></code></pre></div>
<p>Then we can add summary statistics by district, using
<code>gredist</code>’s analysis functions. Here, we’ll compute the
population deviation, the perimeter-based compactness measure related to
the Iowa Code’s redistricting requirements, and the fraction of minority
voters and two-party Democratic vote share by district.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">county_perims</span> <span class="op">=</span> <span class="fu"><a href="http://alarm-gredist.org/redistmetrics/reference/prep_perims.html" class="external-link">prep_perims</a></span><span class="op">(</span><span class="va">iowa_map</span>, <span class="va">iowa_map</span><span class="op">$</span><span class="va">adj</span><span class="op">)</span></span>
<span></span>
<span><span class="va">iowa_plans</span> <span class="op">=</span> <span class="va">iowa_plans</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pop_dev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">total_pop</span> <span class="op">/</span> <span class="fu"><a href="../reference/get_target.html">get_target</a></span><span class="op">(</span><span class="va">iowa_map</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>           comp <span class="op">=</span> <span class="fu"><a href="http://alarm-gredist.org/redistmetrics/reference/comp_polsby.html" class="external-link">comp_polsby</a></span><span class="op">(</span><span class="fu"><a href="../reference/pl.html">pl</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">iowa_map</span>, perim_df<span class="op">=</span><span class="va">county_perims</span><span class="op">)</span>,</span>
<span>           pct_min <span class="op">=</span> <span class="fu"><a href="../reference/gredist.group.percent.html">group_frac</a></span><span class="op">(</span><span class="va">iowa_map</span>, <span class="va">vap</span> <span class="op">-</span> <span class="va">wvap</span>, <span class="va">vap</span><span class="op">)</span>,</span>
<span>           pct_dem <span class="op">=</span> <span class="fu"><a href="../reference/gredist.group.percent.html">group_frac</a></span><span class="op">(</span><span class="va">iowa_map</span>, <span class="va">dem_08</span>, <span class="va">dem_08</span> <span class="op">+</span> <span class="va">rep_08</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">iowa_plans</span><span class="op">)</span></span>
<span><span class="co">#&gt; With plans resampled from weights</span></span>
<span><span class="co">#&gt; Plans matrix: int [1:99, 1:1001] 3 3 1 2 4 1 1 4 1 1 ...</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,004 × 9</span></span></span>
<span><span class="co">#&gt;    draw    district total_pop chain pop_overlap   pop_dev  comp pct_min pct_dem</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> cd_2010 1           <span style="text-decoration: underline;">761</span>548    <span style="color: #BB0000;">NA</span>       1     0.000<span style="text-decoration: underline;">053</span>5 0.302  0.073<span style="text-decoration: underline;">7</span>   0.592</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> cd_2010 2           <span style="text-decoration: underline;">761</span>624    <span style="color: #BB0000;">NA</span>       1     0.000<span style="text-decoration: underline;">046</span>3 0.360  0.096<span style="text-decoration: underline;">8</span>   0.579</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> cd_2010 3           <span style="text-decoration: underline;">761</span>612    <span style="color: #BB0000;">NA</span>       1     0.000<span style="text-decoration: underline;">030</span>5 0.529  0.114    0.531</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> cd_2010 4           <span style="text-decoration: underline;">761</span>571    <span style="color: #BB0000;">NA</span>       1     0.000<span style="text-decoration: underline;">023</span>3 0.522  0.078<span style="text-decoration: underline;">8</span>   0.491</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1       1           <span style="text-decoration: underline;">765</span>206     1       0.875 0.004<span style="text-decoration: underline;">75</span>   0.468  0.066<span style="text-decoration: underline;">5</span>   0.594</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1       2           <span style="text-decoration: underline;">762</span>946     1       0.875 0.001<span style="text-decoration: underline;">78</span>   0.439  0.096<span style="text-decoration: underline;">3</span>   0.579</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1       3           <span style="text-decoration: underline;">757</span>367     1       0.875 0.005<span style="text-decoration: underline;">54</span>   0.247  0.118    0.541</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1       4           <span style="text-decoration: underline;">760</span>836     1       0.875 0.000<span style="text-decoration: underline;">988</span>  0.588  0.083<span style="text-decoration: underline;">1</span>   0.477</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2       1           <span style="text-decoration: underline;">756</span>071     1       0.691 0.007<span style="text-decoration: underline;">25</span>   0.481  0.079<span style="text-decoration: underline;">1</span>   0.594</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2       2           <span style="text-decoration: underline;">765</span>242     1       0.691 0.004<span style="text-decoration: underline;">80</span>   0.274  0.089<span style="text-decoration: underline;">5</span>   0.585</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3,994 more rows</span></span></span></code></pre></div>
<p>Once summary statistics of interest have been calculated, it’s very
important to check the algorithm’s diagnostics. As with any complex
sampling algorithm, things can go wrong. Diagnostics, while not
flawless, can help catch problems and stop you from making conclusions
that are actually the fault of a broken sampling process. The
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function is <code>gredist</code>’s one-stop-shop
for algorithm diagnostics.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">iowa_plans</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">SMC:</span> 1,000 sampled plans of 4 districts on 99 units</span></span>
<span><span class="co">#&gt; `adapt_k_thresh`=0.99 • `seq_alpha`=0.5</span></span>
<span><span class="co">#&gt; `est_label_mult`=1 • `pop_temper`=0</span></span>
<span><span class="co">#&gt; Plan diversity 80% range: 0.45 to 0.81</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; R-hat values for summary statistics:</span></span>
<span><span class="co">#&gt; pop_overlap     pop_dev        comp     pct_min     pct_dem </span></span>
<span><span class="co">#&gt;       1.002       1.014       1.033       1.001       1.014</span></span>
<span><span class="co">#&gt; Sampling diagnostics for SMC run 1 of 2 (500 samples)</span></span>
<span><span class="co">#&gt;          Eff. samples (%) Acc. rate Log wgt. sd  Max. unique Est. k </span></span>
<span><span class="co">#&gt; Split 1       492 (98.4%)      5.6%        0.25   316 (100%)      5 </span></span>
<span><span class="co">#&gt; Split 2       484 (96.8%)      7.5%        0.36   304 ( 96%)      4 </span></span>
<span><span class="co">#&gt; Split 3       476 (95.1%)      3.0%        0.44   272 ( 86%)      3 </span></span>
<span><span class="co">#&gt; Resample      402 (80.5%)       NA%        0.43   407 (129%)     NA</span></span>
<span><span class="co">#&gt; Sampling diagnostics for SMC run 2 of 2 (500 samples)</span></span>
<span><span class="co">#&gt;          Eff. samples (%) Acc. rate Log wgt. sd  Max. unique Est. k </span></span>
<span><span class="co">#&gt; Split 1       491 (98.3%)      5.6%        0.26   309 ( 98%)      5 </span></span>
<span><span class="co">#&gt; Split 2       484 (96.8%)      6.8%        0.36   297 ( 94%)      4 </span></span>
<span><span class="co">#&gt; Split 3       480 (96.1%)      2.9%        0.42   264 ( 84%)      3 </span></span>
<span><span class="co">#&gt; Resample      425 (85.0%)       NA%        0.39   424 (134%)     NA</span></span>
<span><span class="co">#&gt; • <span style="color: #555555;"> Watch out for low effective samples, very low acceptance rates (less than</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">1%), large std. devs. of the log weights (more than 3 or so), and low numbers</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">of unique plans. R-hat values for summary statistics should be between 1 and</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">1.05.</span></span></span></code></pre></div>
<p>There’s a lot of diagnostic output there, which you should read more
about with <code><a href="../reference/summary.redist_plans.html">?summary.redist_plans</a></code>. If anything is obviously
wrong, the function will alert you and provide instructions on how to
try to fix it. But these warnings aren’t flawless, and it’s important to
check the numbers yourself.</p>
<p>If you’ve used 2 or more <code>runs</code>, as we have,
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> will calculate R-hat values. These should be as
close to 1 as possible, and generally less than 1.05. If they are bigger
than that, it means that multiple independent runs of the algorithm gave
different results. More samples (higher <code>nsims</code>) are usually
called for. The other number to keep an eye on is the plan diversity
(top of the output), whose 80% range should generally cover the range
from 0.5–0.8.</p>
<p>Since our diagnostics look good, we can return to our analysis. It’s
quick to turn district-level statistics from a <code>redist_plans</code>
object into plan-level summary statistics.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plan_sum</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">iowa_plans</span>, <span class="va">draw</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>max_dev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pop_dev</span><span class="op">)</span>,</span>
<span>              avg_comp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">comp</span><span class="op">)</span>,</span>
<span>              max_pct_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pct_min</span><span class="op">)</span>,</span>
<span>              dem_distr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pct_dem</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plan_sum</span><span class="op">)</span></span>
<span><span class="co">#&gt; A <span style="color: #0000BB;">&lt;redist_plans&gt;</span> containing 1,000 sampled plans and 1 reference plan</span></span>
<span><span class="co">#&gt; Plans have 4 districts from a 99-unit map, and were drawn using Sequential</span></span>
<span><span class="co">#&gt; Monte Carlo.</span></span>
<span><span class="co">#&gt; With plans resampled from weights</span></span>
<span><span class="co">#&gt; Plans matrix: int [1:99, 1:1001] 3 3 1 2 4 1 1 4 1 1 ...</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,001 × 5</span></span></span>
<span><span class="co">#&gt;    draw      max_dev avg_comp max_pct_min dem_distr</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> cd_2010 0.000<span style="text-decoration: underline;">053</span>5    0.428       0.114         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1       0.005<span style="text-decoration: underline;">54</span>      0.435       0.118         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2       0.007<span style="text-decoration: underline;">25</span>      0.413       0.113         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 3       0.009<span style="text-decoration: underline;">97</span>      0.330       0.128         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 4       0.004<span style="text-decoration: underline;">57</span>      0.365       0.121         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 5       0.008<span style="text-decoration: underline;">94</span>      0.508       0.115         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 6       0.008<span style="text-decoration: underline;">89</span>      0.406       0.119         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 7       0.005<span style="text-decoration: underline;">62</span>      0.350       0.117         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 8       0.009<span style="text-decoration: underline;">21</span>      0.407       0.110         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 9       0.009<span style="text-decoration: underline;">84</span>      0.375       0.119         3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 991 more rows</span></span></span></code></pre></div>
<p>These tables of statistics are easily plotted using existing
libraries like <code>ggplot2</code>, but <code>gredist</code> provides a
number of helpful plotting functions that automate some common tasks,
like adding a reference line for the reference plan. The output of these
functions is a <code>ggplot</code> object, allowing for further
customization.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">plan_sum</span>, <span class="va">max_dev</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">iowa_plans</span>, <span class="va">comp</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides<span class="op">=</span><span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="redist_files/figure-html/dev-comp-plot-1.png" width="700"></p>
<p>We can see that the adopted plan has nearly complete population
parity, and that its districts are roughly as compact on average as
those simulated by the SMC algorithm.</p>
<p>One of the most common, and useful, plots, for studying the partisan
characteristics of a plan, is to plot the fraction of a group (or party)
within each district, and compare to the reference plan. Generally, we
would first sort the districts by this quantity first, to make the
numbers line up, but here we’ve already renumbered the districts to
match the reference plan as closely as possible.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">iowa_plans</span>, <span class="va">pct_dem</span>, sort<span class="op">=</span><span class="cn">FALSE</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="redist_files/figure-html/signature-1.png" width="700"></p>
<p>We see that districts 1 and 2 look normal, but it appears that,
relative to our ensemble, district 4 (NW Iowa) is more Democratic, and
district 3 (SW Iowa, Des Moines) is less Democratic. However, the
reference plan does not appear to be a complete outlier.</p>
<p>We might also want to look at how the Democratic fraction in each
district compares to the fraction of minority voters. We can make a
scatterplot of districts, and overlay the reference districts, using
<code>gredist.plot.scatter</code>. We’ll also color by the district
number (higher numbers are in lighter colors).</p>
<p>Once again, we see that while district 1 and 2 of the reference plan
look normal, district has a lower number of Democrats and minority
voters than would otherwise be expected.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pal</span> <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/pal_viridis.html" class="external-link">viridis_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/gredist.plot.scatter.html">gredist.plot.scatter</a></span><span class="op">(</span><span class="va">iowa_plans</span>, <span class="va">pct_min</span>, <span class="va">pct_dem</span>, </span>
<span>                    color<span class="op">=</span><span class="va">pal</span><span class="op">[</span><span class="fu"><a href="../reference/subset_sampled.html">subset_sampled</a></span><span class="op">(</span><span class="va">iowa_plans</span><span class="op">)</span><span class="op">$</span><span class="va">district</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="redist_files/figure-html/scatter-1.png" width="700"></p>
<p>From here, it is easy to keep exploring, using the functionality of
<code>redist_plans</code> and the built-in plotting functions. More
complex model-based analyses could also be performed using the
district-level or plan-level statistics.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>from <a href="https://arxiv.org/pdf/2008.06131.pdf" class="external-link">Sequential Monte Carlo for
Sampling Balanced and Compact Redistricting Plans</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>based on Carter, D., Herschlag, G., Hunter, Z., and
Mattingly, J. (2019). A merge-split proposal for reversible Monte Carlo
Markov chain sampling of redistricting plans. arXiv preprint
arXiv:1911.01503.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>from <a href="https://doi.org/10.1080/10618600.2020.1739532" class="external-link">Automated
Redistricting Simulation Using Markov Chain Monte Carlo</a> <em>Journal
of Computational and Graphical Statistics</em><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>from <a href="https://imai.fas.harvard.edu/research/files/enumerate.pdf" class="external-link">The
Essential Role of Empirical Validation in Legislative Redistricting
Simulation</a><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>from Cannon, S., Goldbloom-Helzner, A., Gupta, V.,
Matthews, J. N., &amp; Suwal, B. (2020). Voting Rights, Markov Chains,
and Optimization by Short Bursts. arXiv preprint arXiv:2011.02288.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>from Jowei Chen and Jonathan Rodden (2013)
“Unintentional Gerrymandering: Political Geography and Electoral Bias in
Legislatures.” Quarterly Journal of Political Science. 8(3): 239-269.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>for <code>gredist</code>’s purposes, adjacency requires
that two regions touch at more than just one point or corner.<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christopher T. Kenny, Cory McCartan, Ben Fifield, Kosuke Imai.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
