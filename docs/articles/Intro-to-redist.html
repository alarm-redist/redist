<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intro-to-redist • redist</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Intro-to-redist">
<meta property="og:description" content="redist">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">redist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Intro-to-redist.html">Intro-to-redist</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kosukeimai/redist/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Intro-to-redist_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="Intro-to-redist_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="Intro-to-redist_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Intro-to-redist</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kosukeimai/redist/blob/master/vignettes/Intro-to-redist.Rmd"><code>vignettes/Intro-to-redist.Rmd</code></a></small>
      <div class="hidden name"><code>Intro-to-redist.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">redist</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'igraph'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     decompose, spectrum</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sp</span>
<span class="co">#&gt; Loading required package: spData</span>
<span class="co">#&gt; To access larger datasets in this package, install the spDataLarge</span>
<span class="co">#&gt; package with: `install.packages('spDataLarge',</span>
<span class="co">#&gt; repos='https://nowosad.github.io/drat/', type='source')`</span>
<span class="co">#&gt; Loading required package: sf</span>
<span class="co">#&gt; Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>The <code>redist</code> package is designed to allow for replicable redistricting simulations. The package comes loaded with data for simple testing and with functions to simulate redistricting and to run diagnostics on the redistricting plans created. These data form the basis for small-scale validations of sampling methods in <a href="https://imai.fas.harvard.edu/research/files/redist.pdf">Automated Redistricting Simulation Using Markov Chain Monte Carlo</a>. For larger scale validation, see <a href="https://imai.fas.harvard.edu/research/files/enumerate.pdf">The Essential Role of Empirical Validation in Legislative Redistricting Simulation</a>, which has additional methods which will be added to this package later in 2020.</p>
<div id="top" class="section level1">
<h1 class="hasAnchor">
<a href="#top" class="anchor"></a>Table of Contents</h1>
<ul>
<li><a href="#load">Loading redist</a></li>
<li><a href="#data">Included Data</a></li>
<li><a href="#adj">Adjacency-Based Redistricting</a></li>
<li><a href="#mcmc">Redistricting with MCMC</a></li>
<li><a href="#mpi">Redistricting with MCMC using MPI</a></li>
<li><a href="#chains">Using Multiple Chains</a></li>
<li><a href="#rsg">Random Seed Growth</a></li>
<li><a href="#seg">Segregation Index</a></li>
<li><a href="#diag">Diagnostic Plots</a></li>
</ul>
</div>
<div id="loading-redist" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-redist" class="anchor"></a>Loading redist</h1>
<p>redist can be installed either from CRAN, for the stable version with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'redist'</span><span class="op">)</span></code></pre></div>
<p>or from GitHub, which is updated more often:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span>repo <span class="op">=</span> <span class="st">'kosukeimai/redist'</span>, ref <span class="op">=</span> <span class="st">'master'</span><span class="op">)</span></code></pre></div>
<div id="helpful-packages-to-be-used-with-redist-" class="section level2">
<h2 class="hasAnchor">
<a href="#helpful-packages-to-be-used-with-redist-" class="anchor"></a>Helpful Packages to be used with redist.</h2>
<p>This package is often used with a set of other packages: <code>sf</code> and <code>sp</code> are useful for working with shapefiles and can be loaded with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op">)</span></code></pre></div>
<p>For additional functions for working with the shapefiles, using <code>spdep</code> is recommended. This is also used with creating lists of which precincts are adjacent to other precincts. It can be loaded with:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span></code></pre></div>
<p>For plotting maps and adjacency graphs, <code>ggplot2</code> and <code>igraph</code> are useful. The former allows for making ggplot maps, when used with <code>sf</code>. These may be loaded with:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></code></pre></div>
<p>Additionally useful data manipulation tools for working with objects from the package are <code>dplyr</code> and <code>magrittr</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:igraph':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     as_data_frame, groups, union</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">magrittr</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="data" class="section level1">
<h1 class="hasAnchor">
<a href="#data" class="anchor"></a>Included Data</h1>
<p>The package contains four datasets. The first three are <code>algdat.p10</code>, <code>algdat.p20</code>, and <code>algdat.pfull</code> which contain data for 25 continuous precincts within Florida when partitioned into three districts. Respectively, these are those plans which fall within 10% population parity, 20% population parity, and all possible partitions. These are loaded in with the package and can be loaded as follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"algdat.p10"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"algdat.p20"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"algdat.pfull"</span><span class="op">)</span></code></pre></div>
<p>Each algdat object is a list with five objects:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">algdat.p10</span><span class="op">)</span>
<span class="co">#&gt; [1] "adjlist"           "cdmat"             "precinct.data"    </span>
<span class="co">#&gt; [4] "segregation.index" "distancemat"</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">algdat.p20</span><span class="op">)</span>
<span class="co">#&gt; [1] "adjlist"           "cdmat"             "precinct.data"    </span>
<span class="co">#&gt; [4] "segregation.index" "distancemat"</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">algdat.pfull</span><span class="op">)</span>
<span class="co">#&gt; [1] "adjlist"           "cdmat"             "precinct.data"    </span>
<span class="co">#&gt; [4] "segregation.index" "distancemat"</span></code></pre></div>
<ul>
<li><p>adjlist - contains 25 adjacency lists as nb objects from package <code>spdep</code></p></li>
<li><p>cdmat - contains all possible congressional districts under the population constraint for that object as a matrix</p></li>
<li>
<p>precinct.data - data frame with a row for each precinct with five columns: pop, demvote, repvote, blackpop, hispanicpop</p>
<ul>
<li>pop - the total population of the district</li>
<li>demvote - the number of votes cast for Obama in the 2008 presidential election in that precinct</li>
<li>repvote - the number of votes cast for John McCain in the 2008 presidental election in that precinct</li>
<li>blackpop - the number of black individuals in that precinct</li>
<li>hispanicpop - the number of hispanic individuals in that precinct</li>
</ul>
</li>
<li><p>segregation.index - the dissimilarity index of segregation for each plan (The Dimensions of Residential Segregation, Massey &amp; Denton 1987).</p></li>
<li><p>distancemat - a symmetric matrix with the squared distance between two precincts as its entries</p></li>
</ul>
<p>The fourth data set is the sf dataframe, containing the shapes themselves for creating these objects. It can be called with:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"fl25"</span><span class="op">)</span></code></pre></div>
<p>From the head of the data, we can see this is a typical dataframe with a geometry column appended. See the <a href="https://r-spatial.github.io/sf/">website for sf</a> for more information about this type of object.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fl25</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 6 features and 11 fields</span>
<span class="co">#&gt; geometry type:  POLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -81.85582 ymin: 26.4483 xmax: -81.56292 ymax: 26.7171</span>
<span class="co">#&gt; CRS:            NA</span>
<span class="co">#&gt;       geoid10   pop   vap obama mccain TotPop BlackPop HispPop   VAP BlackVAP</span>
<span class="co">#&gt; 2942 2519.0_0 15993 12379   647   1522  15993      863    1980 12379      582</span>
<span class="co">#&gt; 2561 2402.0_0  7799  6084   266    226   7799     2417    1600  6084     1601</span>
<span class="co">#&gt; 2581 2520.0_0  6347  5698   758   1846   6347       97     304  5698       78</span>
<span class="co">#&gt; 2594 2532.0_0  3808  3134   424    828   3808       41     180  3134       27</span>
<span class="co">#&gt; 2687 2438.0_0  4982  4173   668    842   4982      316     837  4173      199</span>
<span class="co">#&gt; 2732 2521.0_0  8907  7587   644    935   8907      195    1147  7587      153</span>
<span class="co">#&gt;      HispVAP                       geometry</span>
<span class="co">#&gt; 2942    1292 POLYGON ((-81.78102 26.6274...</span>
<span class="co">#&gt; 2561    1133 POLYGON ((-81.80102 26.6341...</span>
<span class="co">#&gt; 2581     240 POLYGON ((-81.79772 26.5093...</span>
<span class="co">#&gt; 2594     134 POLYGON ((-81.79842 26.5474...</span>
<span class="co">#&gt; 2687     545 POLYGON ((-81.75042 26.7038...</span>
<span class="co">#&gt; 2732     860 POLYGON ((-81.66622 26.4657...</span></code></pre></div>
<p>Each column contains useful information for typical redistricting questions: * <code>geoid10</code> is a unique identifier. * <code>pop</code> is the population of the precinct. * <code>vap</code> is the voter age population. * <code>obama</code> is the vote count for Obama in the 2012 presidential election. * <code>mccain</code> is the vote count for McCain in the 2012 presidential election. * <code>TotPop</code> is identical to <code>pop</code>. * <code>BlackPop</code> is the number of black residents within the precinct. * <code>HispPop</code> is the number of Hispanic residents within the precinct. * <code>VAP</code> is identical to <code>vap</code>. * <code>BlackVAP</code> is the number of voter age black residents within the precinct. * <code>HispVAP</code> is the number of voter age hispanic residents within the precinct. * <code>geometry</code> contains the sf geometry.</p>
</div>
<div id="adj" class="section level1">
<h1 class="hasAnchor">
<a href="#adj" class="anchor"></a>Adjacency-Based Redistricting</h1>
<p>We begin with a simple example of thinking about adjacency-based redistricting, using a small piece of Florida, named fl25. It can be loaded with the data command as follows. For more information on the data, see <a href="#data">the data section</a></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"fl25"</span><span class="op">)</span></code></pre></div>
<p>This Florida subset contains the shapefiles for the districts, which can be plotted with sf.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fl25</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Intro-to-redist_files/figure-html/unnamed-chunk-11-1.png" width="480"></p>
<p>In this map, the color represents the population, where darker colors are smaller populations. The 25 shapes outlined above are the precincts that we work with. A difficulty in redistricting is that the area of the precinct does not necessarily tell us anything about the population of the precinct. As such, we work with adjacency lists for the precincts.</p>
<p>If we number the districts from 1 to 25, we say that two districts are connected if they share a side, which is referred to as rook contiguity.</p>
<p>If we arbitrarily number the districts from the plot above, we can pick a small subset of them.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fl25</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">25</span>
<span class="va">fl25</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>,<span class="fl">13</span>,<span class="fl">1</span>,<span class="fl">14</span>,<span class="fl">15</span><span class="op">)</span>,<span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Intro-to-redist_files/figure-html/unnamed-chunk-12-1.png" width="480"></p>
<p>Then, the 15th precinct by this numbering is connected to 1, 13, and 14. So, the adjacency list would be 1,13,14. 12, for example, would not be on this list, as it does not share a portion of a side with precinct 25.</p>
<p>To make an adjacency list, we may use the packages <code>spdep</code> with function <code>poly2nb</code>. We use this function with <code>queen = FALSE</code>, as we want the rooks adjacency, not the queens adjacency, which would allow for if only corners touch, like on a chess board.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adjlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spdep/man/poly2nb.html">poly2nb</a></span><span class="op">(</span>pl <span class="op">=</span> <span class="va">fl25</span>, queen <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>We can further verify the above comments by looking at the 25th element of the adjacency list, which corresponds to the 25th district.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adjlist</span><span class="op">[[</span><span class="fl">25</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; [1]  5 22 24</span></code></pre></div>
<p>Using igraph, we can easily plot the whole set of adjacencies:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_adj_list.html">graph_from_adj_list</a></span><span class="op">(</span><span class="va">adjlist</span>, mode <span class="op">=</span> <span class="st">'total'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Intro-to-redist_files/figure-html/unnamed-chunk-15-1.png" width="480"></p>
<p>While these are numbered in 1:25, the back end in C++ requires 0 indexing for efficiency, so we sink the adjacency list to be 0:24.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">)</span><span class="op">{</span>
  <span class="va">adjlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">adjlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">-</span><span class="fl">1</span>
<span class="op">}</span></code></pre></div>
<p>Thus, everything is the same up to naming.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">adjlist</span><span class="op">[[</span><span class="fl">25</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; [1]  4 21 23</span></code></pre></div>
<p>Each algorithm within the package maintains geographically contiguous districts. The <code>MCMC</code> and <code>enumerate</code> algorithms consider the underlying graphical structure of the districts, where contiguity is represented by the edges in the above graph.</p>
<p><a href="#top">Back to top</a></p>
</div>
<div id="mcmc" class="section level1">
<h1 class="hasAnchor">
<a href="#mcmc" class="anchor"></a>Redistricting with MCMC</h1>
<p>To begin running the MCMC algorithm, we have to provide some basic data. We provide the adjacency list to <code>adjobj</code>, a vector of populations to <code>popvec</code>, the number of districts as 3 to <code>ndists</code>, and choose to run 10000 simulations with <code>nsims</code>. We can also save the output with <code>savename</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alg_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redist.mcmc.html">redist.mcmc</a></span><span class="op">(</span>adjobj <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">adjlist</span>,
                        popvec <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
                        ndists <span class="op">=</span> <span class="fl">3</span>,
                        nsims <span class="op">=</span> <span class="fl">10000</span>,
                        savename <span class="op">=</span> <span class="st">"redist.mcmc"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; redist.mcmc(): Automated Redistricting Simulation Using</span>
<span class="co">#&gt;          Markov Chain Monte Carlo</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Preprocessing data.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; Using redist.rsg() to generate starting values.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 10 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.965966</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 20 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.967984</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 30 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.966656</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 40 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.965741</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 50 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964993</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 60 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.965328</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 70 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964852</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 80 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964996</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 90 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964329</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 100 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964796</span></code></pre></div>
<p>Note that we do not need to specify <code>ndists</code> when we supply a different argument, <code>initcds</code>, which is the set of districts to initialize to. If we do not specific <code>initcds</code>, the <a href="#rsg">RSG</a> function is run to initialize districts. When tuning parameters, the <code>initcds</code> argument may be useful for ensuring diverse starting positions for different chains, though this is not typically necessary.</p>
<p>We can specify <code>initcds</code>, for example, as the first column of the full enumeration in <code>algdat.pfull</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">initcds</span> <span class="op">&lt;-</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">cdmat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alg_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redist.mcmc.html">redist.mcmc</a></span><span class="op">(</span>adjobj <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">adjlist</span>,
                        popvec <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
                        initcds <span class="op">=</span> <span class="va">initcds</span>,
                        nsims <span class="op">=</span> <span class="fl">10000</span>,
                        savename <span class="op">=</span> <span class="st">"redist.mcmc"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; redist.mcmc(): Automated Redistricting Simulation Using</span>
<span class="co">#&gt;          Markov Chain Monte Carlo</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Preprocessing data.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 10 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.95996</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 20 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.962981</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 30 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.959987</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 40 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.96174</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 50 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.960792</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 60 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.96216</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 70 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.961423</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 80 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.960745</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 90 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.961996</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 100 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.961796</span></code></pre></div>
<p>Once we’ve run the algorithm, the output is of class <code>redist</code>. As <code>savename</code> was provided, there is an Rdata file created in the working directory with a copy of the output.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">alg_mcmc</span><span class="op">)</span>
<span class="co">#&gt; [1] "redist"</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">alg_mcmc</span><span class="op">)</span>
<span class="co">#&gt;  [1] "partitions"             "distance_parity"        "distance_original"     </span>
<span class="co">#&gt;  [4] "mhdecisions"            "mhprob"                 "pparam"                </span>
<span class="co">#&gt;  [7] "beta_sequence"          "energy_psi"             "constraint_pop"        </span>
<span class="co">#&gt; [10] "constraint_compact"     "constraint_vra"         "constraint_similar"    </span>
<span class="co">#&gt; [13] "constraint_countysplit" "boundary_partitions"    "boundaryratio"</span></code></pre></div>
<p>For simple runs of the algorithm, the most important pieces of the output are <code>partitions</code> and <code>distance_parity</code>. The <code>partitions</code> object is a matrix with <code>ndist</code> rows and <code>nsims</code> columns. Each column is one redistricting plan, where the numbers go from 0 to n-1, with each number represents the district assignment.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alg_mcmc</span><span class="op">$</span><span class="va">partitions</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt;  [1] 0 1 2 2 2 2 2 2 0 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span></code></pre></div>
<p>The <code>distance_parity</code> output provides the population parity of the districts as an array with <code>nsims</code> entries.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alg_mcmc</span><span class="op">$</span><span class="va">distance_parity</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt; [1] 1.305439</span></code></pre></div>
<p>The additional outputs are useful for implementing the algorithm with constraints.</p>
<p><a href="#top">Back to top</a></p>
</div>
<div id="mpi" class="section level1">
<h1 class="hasAnchor">
<a href="#mpi" class="anchor"></a>Redistricting with MCMC using MPI</h1>
<p>The running of this function is the same as in redist.mcmc, but it requires Rmpi installed.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://fisher.stats.uwo.ca/faculty/yu/Rmpi">Rmpi</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/redist.mcmc.mpi.html">redist.mcmc.mpi</a></span><span class="op">(</span>adjobj <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">adjlist</span>,
                popvec <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
                nsims <span class="op">=</span> <span class="fl">10000</span>, 
                ndists <span class="op">=</span> <span class="fl">3</span>,
                savename <span class="op">=</span> <span class="st">"redist.mcmc.mpi"</span><span class="op">)</span></code></pre></div>
<p>Outputs and usage are the same as in the <a href="#mcmc">MCMC Section</a>, but MPI will allow for much faster computation.</p>
<p><a href="#top">Back to top</a></p>
</div>
<div id="chains" class="section level1">
<h1 class="hasAnchor">
<a href="#chains" class="anchor"></a>Using Multiple Chains</h1>
<p>When running larger redistricting analyses, one important step is to run multiple chains of the MCMC algorithm. This will also allow us to diagnose convergence better, using the Gelman-Rubin plot, as seen in the section on <a href="#diag">Diagnostic Plots</a>.</p>
<p>On Windows and in smaller capacities, it is useful to run the algorithm within an lapply loop. First, we set up the seed for replicability and decide on the number of chains and simulations.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">RNGkind</a></span><span class="op">(</span>kind <span class="op">=</span> <span class="st">"L'Ecuyer-CMRG"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">nchains</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="va">nsims</span> <span class="op">&lt;-</span> <span class="fl">10000</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mcmc_chains</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nchains</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
          <span class="fu"><a href="../reference/redist.mcmc.html">redist.mcmc</a></span><span class="op">(</span>adjobj <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">adjlist</span>, 
                      popvec <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>, 
                      nsims <span class="op">=</span> <span class="va">nsims</span>,
                      ndists <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; redist.mcmc(): Automated Redistricting Simulation Using</span>
<span class="co">#&gt;          Markov Chain Monte Carlo</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Preprocessing data.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; Using redist.rsg() to generate starting values.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 10 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964965</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 20 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.961981</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 30 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.963988</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 40 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.95974</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 50 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.961392</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 60 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.96066</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 70 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.961566</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 80 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.96087</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 90 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.960662</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 100 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.960596</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; redist.mcmc(): Automated Redistricting Simulation Using</span>
<span class="co">#&gt;          Markov Chain Monte Carlo</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Preprocessing data.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; Using redist.rsg() to generate starting values.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 10 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.955956</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 20 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.96048</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 30 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.962654</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 40 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.96049</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 50 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.962593</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 60 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.962827</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 70 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.963566</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 80 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964371</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 90 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.963663</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 100 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.963696</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; redist.mcmc(): Automated Redistricting Simulation Using</span>
<span class="co">#&gt;          Markov Chain Monte Carlo</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Preprocessing data.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; Using redist.rsg() to generate starting values.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 10 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.958959</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 20 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.961481</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 30 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964321</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 40 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.966992</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 50 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.967193</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 60 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.966994</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 70 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.966995</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 80 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.966371</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 90 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.965996</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 100 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.965597</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; redist.mcmc(): Automated Redistricting Simulation Using</span>
<span class="co">#&gt;          Markov Chain Monte Carlo</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Preprocessing data.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; Using redist.rsg() to generate starting values.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 10 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.968969</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 20 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.965483</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 30 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964655</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 40 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.963491</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 50 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.963993</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 60 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.962494</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 70 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.96328</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 80 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.96387</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 90 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964218</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 100 percent done.</span>
<span class="co">#&gt; Metropolis acceptance ratio: 0.964896</span></code></pre></div>
<p>In unix-based systems, this can be run considerably faster by running this in parallel.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mcmc_chains</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/mcdummies.html">mclapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nchains</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
          <span class="fu"><a href="../reference/redist.mcmc.html">redist.mcmc</a></span><span class="op">(</span>adjobj <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">adjlist</span>, 
                      popvec <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>, 
                      nsims <span class="op">=</span> <span class="va">nsims</span>,
                      ndists <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="op">}</span>, mc.set.seed <span class="op">=</span> <span class="fl">1</span>, mc.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><a href="#top">Back to top</a></p>
</div>
<div id="rsg" class="section level1">
<h1 class="hasAnchor">
<a href="#rsg" class="anchor"></a>Random Seed Growth</h1>
<p>This package also contains an implementation of Chen and Rodden’s non-compact Random Seed and Grow redistricting algorithm from their paper <a href="https://web.stanford.edu/~jrodden/wp/florida.pdf">Unintentional Gerrymandering: Political Geography and Electoral Biases in Legislatures</a>.</p>
<p>The adjacency list, via <code>adj.list</code>, is created as in <a href="#adj">Adjacency-Based Redistricting</a>, <code>population</code> is the population of the districts, <code>ndists</code> is the number of districts, and <code>thresh</code> is the allowed population parity. A <code>thresh</code> of <code>0.05</code> allows for 5% population parity. In easier redistricting questions, a small <code>maxiter</code> is typically sufficient, but in large maps, values may be closer to <code>50,000</code> to ensure that a solution is found.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rsg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redist.rsg.html">redist.rsg</a></span><span class="op">(</span>adj.list <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">adjlist</span>,
                  population <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span>,
                  ndists <span class="op">=</span> <span class="fl">3</span>,
                  thresh <span class="op">=</span> <span class="fl">0.05</span>, 
                  maxiter <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==================== </span>
<span class="co">#&gt; redist.rsg(): Automated Redistricting Starts</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  3 districts built using 25 precincts in 0 seconds...</span></code></pre></div>
<p>The output of <code>redist.rsg</code> is a list with three objects. <code>district_membership</code> provides a numeric array with indices for which district each precinct belongs to.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rsg</span><span class="op">$</span><span class="va">district_membership</span>
<span class="co">#&gt;  [1] 1 1 2 2 0 2 0 0 2 1 1 1 1 2 2 1 0 1 0 0 2 0 2 0 0</span></code></pre></div>
<p><code>district_list</code> will provide an alternate formulation of this with <code>ndists</code> arrays, indicating which precincts are in each district.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rsg</span><span class="op">$</span><span class="va">district_list</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] 19  7  6 23  4 21 24 18 16</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1]  0 12 11  1 10 17 15  9</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1]  5 22  2  8  3 13 14 20</span></code></pre></div>
<p>Corresponding to this, <code>district_pop</code> will give the district population for each of the <code>ndists</code> districts.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rsg</span><span class="op">$</span><span class="va">district_pop</span>
<span class="co">#&gt; [1] 59125 56965 58953</span></code></pre></div>
<p><a href="#top">Back to top</a></p>
</div>
<div id="seg" class="section level1">
<h1 class="hasAnchor">
<a href="#seg" class="anchor"></a>Segregation Index</h1>
<p>To evaluate redistricting plans, the <code>redist</code> package comes with the <code>redist.segcalc</code> function. This computes the segregation index introduced in Massey and Denton 1987.</p>
<p>It takes three arguments, <code>algout</code>, which is a <code>redist</code> object from the various <code>mcmc</code> function or <code>rsg</code> function, <code>grouppop</code> which is the population of the group being used for comparison, and <code>fullpop</code> is the total population of the precinct.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/redist.segcalc.html">redist.segcalc</a></span><span class="op">(</span>algout <span class="op">=</span> <span class="va">alg_mcmc</span>, 
                      grouppop <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">blackpop</span>,
                      fullpop <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span></code></pre></div>
<p>This returns a numeric vector with the an entry for each district provided.</p>
<p><a href="#top">Back to top</a></p>
</div>
<div id="diag" class="section level1">
<h1 class="hasAnchor">
<a href="#diag" class="anchor"></a>Diagnostic Plots</h1>
<p>When using the MCMC algorithms, there are various useful diagnostic plots. The <code>redist.diagplot</code> function creates familiar plots by converting numeric entries into <code>mcmc</code> objects to use with <code>coda</code>.</p>
<p>The first four plots take a single index, such as one created by <code>redist.segcalc</code>. * Trace Plot</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/redist.diagplot.html">redist.diagplot</a></span><span class="op">(</span><span class="va">seg</span>, plot <span class="op">=</span> <span class="st">"trace"</span><span class="op">)</span></code></pre></div>
<p><img src="Intro-to-redist_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<ul>
<li>Autocorrelation Plot</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/redist.diagplot.html">redist.diagplot</a></span><span class="op">(</span><span class="va">seg</span>, plot <span class="op">=</span> <span class="st">"autocorr"</span><span class="op">)</span></code></pre></div>
<p><img src="Intro-to-redist_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<ul>
<li>Density Plot</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/redist.diagplot.html">redist.diagplot</a></span><span class="op">(</span><span class="va">seg</span>, plot <span class="op">=</span> <span class="st">"densplot"</span><span class="op">)</span></code></pre></div>
<p><img src="Intro-to-redist_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<ul>
<li>Mean Plot</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/redist.diagplot.html">redist.diagplot</a></span><span class="op">(</span><span class="va">seg</span>, plot <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></code></pre></div>
<p><img src="Intro-to-redist_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<p>The final plot requires at least two chains.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">seg_chains</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nchains</span>, 
                     <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="../reference/redist.segcalc.html">redist.segcalc</a></span><span class="op">(</span>algout <span class="op">=</span> <span class="va">mcmc_chains</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, 
                                  grouppop <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">blackpop</span>,
                                  fullpop <span class="op">=</span> <span class="va">algdat.pfull</span><span class="op">$</span><span class="va">precinct.data</span><span class="op">$</span><span class="va">pop</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="../reference/redist.diagplot.html">redist.diagplot</a></span><span class="op">(</span><span class="va">seg_chains</span>, plot <span class="op">=</span> <span class="st">'gelmanrubin'</span><span class="op">)</span></code></pre></div>
<p><img src="Intro-to-redist_files/figure-html/unnamed-chunk-37-1.png" width="700"> Beware that this diagnostic will often fail to converge if there are insufficient iterations. If an error is thrown and no plot is created, try increasing <code>nsims</code>.</p>
<p><a href="#top">Back to top</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ben Fifield, Christopher T. Kenny, Cory McCartan, Alexander Tarr, Jun Kawahara, Kosuke Imai.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
